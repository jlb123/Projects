**********************************************************************************;
*PROGRAM: S:\USER\JBLASE\H Pylori and CRC\PROGRAM\H Pylori and CRC Cohort.SAS  	 *;
*PURPOSE: Cohort for H. Pylori and CRC study									 *;
*LAST MODIFIED: 5/24/15 BY JENNY BLASE                                           *;
**********************************************************************************;

*RUN ENTIRE COHORT LOCALLY*;
options extendobscounter=no MPRINT;

LIBNAME HPY 'S:\USER\JBLASE\H Pylori and CRC\DATA';
LIBNAME ORIG82 'S:\CPS\CPS2\ORIGINAL';
LIBNAME ORG    'S:\CPS\NUTRITION\ORIGINAL';
LIBNAME DER    'S:\CPS\NUTRITION\DERIVED';
LIBNAME LLDRIV 'S:\CPS\BIOSPECIMENS\Lifelink\Derived';
LIBNAME VERIFY 'S:\CPS\NUTRITION\VERIFIED';
LIBNAME MAST   'S:\CPS\MASTER';
LIBNAME PYEAR 'S:\CPS\NUTRITION\PYEAR';
LIBNAME CPS2DERV 'S:\CPS\CPS2\DERIVED';
LIBNAME MORT 'S:\CPS\MORTALITY';

***INITIAL IMPORTI H.PYLORI LAB DATASET**;

/*PROC IMPORT OUT=HPY.LABDATA*/
/*            DATAFILE= "S:\USER\JBLASE\H Pylori and CRC\DATA\Transferfile L Teras CRC.xlsx" */
/*            DBMS=EXCELCS REPLACE;*/
/*			RANGE = "A4:AZ1551"; */
/*			SHEET="study data";*/
/*RUN;*/
/**/
/*PROC EXPORT DATA=HPY.plate_id_info_all_jenny3*/
/*	OUTFILE='S:\USER\JBLASE\H Pylori and CRC\DATA\CACODATA.CSV'*/
/*	DBMS=CSV REPLACE;*/
/*RUN;*/
/**/
/*PROC IMPORT OUT=HPY.CACODATA*/
/*            DATAFILE= 'S:\USER\JBLASE\H Pylori and CRC\DATA\CACODATA.CSV' */
/*            DBMS=CSV REPLACE; */
/*RUN;*/



PROC FORMAT;

VALUE CACONEWF 0='CONTROL'
			   1='CASE';

VALUE $ SERONPF   '0'='SERO -'
			      '1'='SERO +';

VALUE $ TERTSF	'0'='<=33%'
				'1'='33-67%'
				'2'='>67%';

VALUE $ TERTS2F '0'='SERO -'
				'1'='<=33%'
				'2'='33-67%'
				'3'='>67%';

VALUE SEX		0 = 'Female'
				1 = 'Male';

VALUE RACENEW 1 = 'White'
			  2 = 'Black'
			  3 = 'Other/Missing';

VALUE $ SMOKE '1' = 'NEVER'
			  '2' = 'CURRENT'
			  '3' = 'FORMER'
			  '9' = 'MISSING';

VALUE BMIWHO 	0='0: <25.0 (UNDER/NORMAL)'				
			 	1='1: 25.0-<30.0 (OVERWEIGHT)'
			 	2='2: >=30.0 (OBESE)'
			 	9='9: UNKNOWN'; 

VALUE EDUCAF    1 = '1: Less than high school'
				2 = '2: High school/missing education'
				3 = '3: Some college/vocational school'
				4 = '4: College/graduate school'; 

VALUE ALC	1 = '0 DRINKS/DAY'
			2 = '<=1 DRINKS/DAY'
			3 = '>1 DRINKS/DAY'
			9 = 'MISSING';

VALUE MSF	1="MARRIED"
			2="WIDOWED"
			3="SEPARATED/DIVORCED"
			4="NEVER MARRIED"
			9="MISSING";

VALUE MEATF	0="0 SERVINGS"
			1="<1 SERVINGS"
			2=">1 SERVINGS";

VALUE YESNOF 0="NO"
			 1="YES"
			 9="MISSING";

VALUE YESNO2F	0='NO'
				1='YES'
				.='MISSING';

VALUE CPDF   1="1-4 CPD"
			 2="5-14 CPD"
			 3="15-24 CPD"
			 4="25-34 CPD"
			 5="35-44 CPD"
			 6="45+ CPD"
			 9="MISSING/FORMER/NONSMOKERS";

VALUE ASPDURF 0="NEVER"
			  1="OCCASIONAL/FORMER"
			  2="30+DAYS/MO,<5 YRS"
			  3="30+DAYS/MO,5+YRS";

VALUE ASPREGF  0 = "NO REGULAR USE"
			   1 = "1-14 PILLS/MONTH"
			   2 = "15-29 PILLS/MONTH"
			   3 = "30-59 PILLS/MONTH"
 			   4 = "60-119 PILLS/MONTH"
			   5 = "120+ PILLS/MONTH"
			   9 = "MISSING";

VALUE PAF	0="Inactive"
			1="Below recommended activity"
			2="Recommended and above"
			9="Missing";


VALUE $ POL97F	'1'="NEVER"
				'2'="BEFORE 1992"
				'3'="1992-1993"
				'4'="1994-1995"
				'5'="1996 OR AFTER"
				' '="MISSING";

VALUE POL99F	0="NEVER"
				1="BEFORE OCT 1997"
				2="OCT 1997-SEPT 1999"
				3="AFTER SEPT 1999"
				9="MISSING";

VALUE $ POL01F	'1'="NEVER"
				'2'="BEFORE OCT 1999"
				'3'="OCT 1999-SEPT 2001"
				'4'="AFTER SEPT 2001"
				' '="MISSING";

VALUE $ POL03F	'1'="NEVER"
				'2'="BEFORE OCT 2001"
				'3'="OCT 2001-JULY 2003"
				'4'="AFTER JULY 2003"
				' '="MISSING";

VALUE $ STATF '1'="ALWAYS NEVER"
			  '2'="CURRENT"
			  '3'="EVER, NOT CURRENT"
			  '9'="MISSING";

VALUE $ COLSCREEN	'1'='NONE, PAST 2 YRS'
					'2'='SX, PAST 2 YRS'
					'3'='ROUTINE, PAST 2 YRS'
					'4'='SX AND ROUTINE, PAST 2 YRS'
					' '='MISSING';

VALUE $ EVRSIGF	'0'='NEVER'
				'1'='EVER/NONE PAST 2 YRS'
				'2'='SX, PAST 2 YRS'
				'3'='ROUTINE, PAST 2 YRS'
				'4'='SX AND ROUTINE, PAST 2 YRS'
				' '='MISSING';

VALUE	POLYPF	0="NEVER"
				1="BEFORE 1992"
				2="1992-1993"
				3="1994-1995"
				4="1996 OR AFTER"
				5="BEFORE OCT 1997"
				6="OCT 1997-SEPT 1999"
				7="AFTER SEPT 1999"
				.="MISSING";
RUN;

*CASE/CONTROL DATA FROM CARI*;
DATA NOQC;
SET HPY.plate_id_info_all_jenny3;

IF CaCoQC NOT IN ('5','9'); *REMOVING QC AND RANDOM OBSERVATIONS*;

RUN;

PROC SORT DATA=NOQC; BY Current_Label; RUN;
PROC SORT DATA=HPY.LABDATA OUT=LABDATASORT; BY CURRENT_LABEL; RUN;

*MERGING CARI'S DATA WITH DATA FROM LAB AND RENAMING ANTIGENS*;
DATA LABDATA2; 
MERGE	NOQC (IN=INNOQC RENAME=(CRCDXDATE=DXDATE)) 
		LABDATASORT (RENAME=(HP_10__G27_=GroEl HP_73_=UreA HP_231=HP0231 HP_243_=NapA HP_305_=HP0305 HP_410_=HpaA HP_537_=CagM HP547=CagA HP_547_1=HP547_1 HP_547_2_=HP547_2 HP695=HyuA 
						HP_695_1_=HP695_1 HP_695_2_=HP695_2 HP_875_=Catalase HP887=VacA HP_887_1_=HP887_1 HP_887_2_=HP887_2 HP_1098_=HcpC HP_1104_=Cad HP_1564_=Omp cagA_G27__subfragment=CAGA_G27 
						cagA_F32__subfragment=CAGA_F32 homB_1__J99__=HOMB1_J99 homB_2__J99__=HOMB2_J99 HomB__J99_=HOMB Western_CagA_CC=WEST_CAGA East_Asian_CagA_D=EASIA_CAGA 
						CagA_CC_and_CagA_D_=CAGACCD EBNA_truncated=EBNA HPyV_9_VP1=HPYV9 HPyV_10_VP1=HPYV10 HPyV_10_T_antigen=HPYV10T_ANT pp150_Nter=PP150 ))
;
BY Current_Label;
IF INNOQC;

*DELETING 17 OBSERVATIONS FROM BIOSPECIMENS DATASET THAT WERE ADDED BACK THAT ARE MISSING LAB DATA*;
IF HP_class=. THEN DELETE; 

*DELETING THE MATCHED SET IF THE CASE HAD MISSING LAB VALUES*;
IF MATCH IN (75,94,169,187,188,194,223) THEN DELETE;

*CONVERTING P53 FROM CHARACTER TO NUMERIC*;
P_53=ROUND(P53,.01);

*RECATEGORIZING OUTCOME FOR MODELING*;
IF CACOQC='1' THEN CACONEW=1; *CASES*;
ELSE IF CACOQC='2' THEN CACONEW=0; *CONTROLS*;

*MAKING SEROPOSITIVE/SERONEGATIVE CATEGORIES FROM CUTPOINTS IN SPREADSHEET*;
*H. PYLORI*;
*GroEl*;
IF GroEl LE 30 THEN GroEl_NP=0;
ELSE GroEl_NP=1;

*UreA*;
IF UreA LE 46 THEN UreA_NP=0;
ELSE UreA_NP=1;

*HP0231*;
IF HP0231 LE 37 THEN HP0231_NP=0;
ELSE HP0231_NP=1;

*NapA*;
IF NapA LE 30 THEN NapA_NP=0;
ELSE NapA_NP=1;

*HP0305*;
IF HP0305 LE 30 THEN HP0305_NP=0;
ELSE HP0305_NP=1;

*HpaA*;
IF HpaA LE 30 THEN HpaA_NP=0;
ELSE HpaA_NP=1;

*CagM*;
IF CagM LE 30 THEN CagM_NP=0;
ELSE CagM_NP=1;

*CagA*;
IF CagA LE 841 THEN CagA_NP=0;
ELSE CagA_NP=1;

*HyuA*;
IF HyuA LE 81 THEN HyuA_NP=0;
ELSE HyuA_NP=1;

*Catalase*;
IF Catalase LE 386 THEN Catalase_NP=0;
ELSE Catalase_NP=1;

*VacA*;
IF VacA LE 67 THEN VacA_NP=0;
ELSE VacA_NP=1;

*HcpC*;
IF HcpC LE 33 THEN HcpC_NP=0;
ELSE HcpC_NP=1;

*Cad*;
IF Cad LE 30 THEN Cad_NP=0;
ELSE Cad_NP=1;

*Omp*;
IF Omp LE 179 THEN Omp_NP=0;
ELSE Omp_NP=1;

*CAGA_G27*;
IF CAGA_G27 LE 30 THEN CAGA_G27_NP=0;
ELSE CAGA_G27_NP=1;

*CAGA_F32*;
IF CAGA_F32 LE 30 THEN CAGA_F32_NP=0;
ELSE CAGA_F32_NP=1;

*HOMB*;
IF HOMB LE 51 THEN HOMB_NP=0;
ELSE HOMB_NP=1;

*P53*;
IF P_53 LE 200 THEN P_53_NP=0;
ELSE P_53_NP=1;
 

RUN;


*MAKING TERTILE VARIABLES FOR INDIVIDUAL ANTIGENS AMONGST SEROPOSITIVES*;
%MACRO TERTILES;

%LET NPANTLIST=GroEl_NP UreA_NP HP0231_NP NapA_NP HP0305_NP HpaA_NP CagM_NP CagA_NP HyuA_NP Catalase_NP VacA_NP HcpC_NP Cad_NP Omp_NP HOMB_NP P_53_NP;
%LET ANTLIST=GroEl UreA HP0231 NapA HP0305 HpaA CagM CagA HyuA Catalase VacA HcpC Cad Omp HOMB P_53;

	%DO A=1 %TO 16;
		%LET NPANTIGEN=%SCAN(&NPANTLIST, &A, %STR( ));
		%LET ANTIGEN=%SCAN(&ANTLIST, &A, %STR( ));


*CREATING TERTILES AMONG SEROPOSTIVES (CUTPOINTS BASED OFF OF TERTILES OF SEROPOSITIVE CONTROLS)*;

PROC UNIVARIATE DATA=LABDATA2;
VAR &ANTIGEN;
WHERE &NPANTIGEN=1 AND CACONEW=0; *SEROPOSITIVE FOR THAT ANTIGEN (NOT NECESSARILY SEROPOSITIVE OVERALL, E.G. NOT CONSIDERING HP_CLASS) CONTROLS*;
OUTPUT OUT=CATS_&ANTIGEN PCTLPTS= 33 67 PCTLPRE=&ANTIGEN._PCT;
RUN;

DATA _NULL_;
SET CATS_&ANTIGEN;

CALL SYMPUT("&ANTIGEN._1",&ANTIGEN._PCT33);
CALL SYMPUT("&ANTIGEN._2",&ANTIGEN._PCT67);

RUN;

*CREATING TERTILES WITH SERONEGATIVE AS REFERENCE GROUP*;
DATA LABDATA2;
SET LABDATA2;

IF &NPANTIGEN=0 THEN &ANTIGEN._TERT=0;

IF &NPANTIGEN=1 THEN DO;
	
	IF &ANTIGEN LE &&&ANTIGEN._1 THEN &ANTIGEN._TERT=1;
	ELSE IF &ANTIGEN GT &&&ANTIGEN._1 AND &ANTIGEN LE &&&ANTIGEN._2 THEN &ANTIGEN._TERT=2;
	ELSE IF &ANTIGEN GT &&&ANTIGEN._2 THEN &ANTIGEN._TERT=3;

END; 
%END;

RUN;

%MEND TERTILES;

%TERTILES;

DATA VERIFY; 
SET VERIFY.FEB2013VERIFIED; 

	***CLEAN AND CONVERT DX DAY, MONTH, AND YEAR TO NUMERIC DATA**;
	IF DODDY IN ('99', 'XX') THEN DODDYN=15; ELSE DODDYN=INPUT(DODDY,2.);              
	IF DODMO='99' THEN DODMON=6; ELSE DODMON=INPUT(DODMO,2.);               
	IF DODMON IN (4,6,9,11) AND DODDYN > 30 THEN DODDYN=30;
	ELSE IF DODMON = 2 AND DODDYN > 28 THEN DODDYN=28; 
	 
	DODYRN=INPUT(DODYR,4.);  
	DXDATE=MDY(DODMON,DODDYN,DODYRN); 

RUN; 

PROC SORT DATA=VERIFY; BY ID DXDATE; RUN; 
PROC SORT DATA=LABDATA2; BY ID DXDATE; RUN; 

*MERGING LAB DATA WITH THE VERIFIED FILE*;
DATA JB;
MERGE LABDATA2(IN=INLAB2)
      VERIFY (IN=VER KEEP=DATASRC HISTOGY ID DXDATE SITEC GSSTAGE INCCANV); 

BY ID DXDATE; *MERGING BY ID AND DXDATE ENSURES THAT THE PEOPLE WHO HAVE MULTIPLE VERIFIED CANCER DIAGNOSES ARE MATCHED TO THE CORRECT DIAGNOSIS SINCE THIS SHOULD 
				MATCH THE DATE THAT CARI GAVE;
IF INLAB2=1;

*DELETING 3 OBS THAT HAVE MULTIPLE CRC DIAGNOSES ON THE SAME DAY BASED ON SITE CODE;
IF ID='14091006003021' AND SITEC='61.9' THEN DELETE; *PROSTATE CANCER DX ON SAME DAY*;
IF ID='25058001010101' AND SITEC='16.0' THEN DELETE; *CARDIA CANCER DX ON SAME DAY*;
IF ID='33012041008032' AND SITEC='20.9' THEN DELETE; *DX OF COLON, NOS AND RECTUM, NOS ON SAME DAY - GETTING RID OF RECTUM, NOS TO REMOVE DUPLICATE*;

*N=5 OBS HAVE DUPLICATE IDS (BOTH CASES AND CONTROLS) --> IDS (06019217011161,06018001001091,33010002011091,23081039001302,23062409004091)*;

RUN; 

*************************************************************;
*CREATE ANALYTIC COHORT                                     *;
*************************************************************;
DATA HPY.FINALCOHORT;
MERGE JB (IN=INJB)
	  ORG.SURVEY92MEN (KEEP=ID COLPOL92 CIG10092 CIGNOW92 CAD92  CIGNUM92 STROKE92 EMPHYS92 DIABET92 HBP92 HICHOL92 STATE ASPDAY92 ASPPIL92 IBUDAY92 IBUPIL92 OTHDAY92 
						OTHPIL92 ASPYRS92)
	  ORG.SURVEY92WOMEN (KEEP=ID COLPOL92 CIG10092 CIGNOW92 CAD92  CIGNUM92 STROKE92 EMPHYS92 DIABET92 HBP92 HICHOL92 STATE ASPDAY92 ASPPIL92 IBUDAY92 IBUPIL92 OTHDAY92 
						OTHPIL92 ASPYRS92)
	  ORG.SURVEY97MEN (KEEP=ID COLPOL97 SURVEY97 CIGNOW97 CIGNUM97 REGDAY97 REGPIL97 BADAY97 BAPIL97 IBUDAY97 IBUPIL97 OTHDAY97 OTHPIL97)
	  ORG.SURVEY97WOMEN (KEEP=ID COLPOL97 SURVEY97 CIGNOW97 CIGNUM97 ESPR97 ONE97 ESPRYR97 ONEYR97 ESTR97 ESTRYR97 REGDAY97 REGPIL97 BADAY97 BAPIL97 IBUDAY97 IBUPIL97 OTHDAY97 
						 OTHPIL97)
	  ORG.SURVEY99MEN (IN=M KEEP=ID BEER99 BEERLT99 WINERE99 WINEWH99 LIQUOR99 MS99 BEHDOG99 MEATS99 CHHDOG99 BACON99 HAMREG99 HAMLEA99 BESAND99 BEEF99 PORK99
					   BELIVR99 CHLIVR99 SALAMI99 COLPOL99 SURVEY99 CIGNOW99 CIGNUM99 BANEV99 REGNEV99 IBUNEV99 ACENEV99 OTHNEV99 BADAY99 REGDAY99 IBUDAY99 ACEDAY99 OTHDAY99 
					   BAPIL99 REGPIL99 IBUPIL99 ACEPIL99 OTHPIL99)
	  ORG.SURVEY99WOMEN (KEEP=ID BEER99 BEERLT99 WINERE99 WINEWH99 LIQUOR99 MS99 BEHDOG99 MEATS99 CHHDOG99 BACON99 HAMREG99 HAMLEA99 BESAND99 BEEF99 PORK99
						BELIVR99 CHLIVR99 SALAMI99 COLPOL99 SURVEY99 CIGNOW99 CIGNUM99 BANEV99 REGNEV99 IBUNEV99 ACENEV99 OTHNEV99 BADAY99 REGDAY99 IBUDAY99 ACEDAY99 OTHDAY99 
						BAPIL99 REGPIL99 IBUPIL99 ACEPIL99 OTHPIL99)
	  ORG.SURVEY01MEN (KEEP=CIGNOW01 CIGNUM01 ID ULCOLD01 ULCOLY01 SURVEY01 HPYL01 HPYLAG01 COLPOL01)
	  ORG.SURVEY01WOMEN (KEEP=CIGNOW01 CIGNUM01 ID ULCOLD01 ULCOLY01 SURVEY01 HPYL01 HPYLAG01 COLPOL01)
	  ORG.SURVEY03MEN (KEEP=CIGNOW03 CIGNUM03 ID COLPOL03)
	  ORG.SURVEY03WOMEN (KEEP=CIGNOW03 CIGNUM03 ID COLPOL03)
	  ORG.SURVEY05MEN (KEEP=CIGNOW05 CIGNUM05 ID)
	  ORG.SURVEY05WOMEN (KEEP=CIGNOW05 CIGNUM05 ID)
      ORG.SURVEY07MEN (KEEP=CIGNOW07 CIGNUM07 ID)
	  ORG.SURVEY07WOMEN (KEEP=CIGNOW07 CIGNUM07 ID)	
	  
      DER.SURVEY92MENKEYVAR2 (KEEP=ID REGION92 SMK92 DTINT92 CPD92 SMKYRS92 AGESMK92 AGEQT92)
	  DER.SURVEY92FEMKEYVAR2 (KEEP=ID REGION92 SMK92 DTINT92 CPD92 SMKYRS92 AGESMK92 AGEQT92 HRTKIND92M)

	  DER.SURVEY97MENKEYVAR2 (KEEP=ID SMK97 FMHXCR97 EVRSIG97 DTINT97 ASPUSE97 BASPUSE97 IBUUSE97 ONDUSE97)
	  DER.SURVEY97FEMKEYVAR2 (KEEP=ID SMK97 FMHXCR97 EVRSIG97 HRTKIND97 DTINT97 ASPUSE97 BASPUSE97 IBUUSE97 ONDUSE97)

	  DER.SURVEY99MENKEYVAR (KEEP=ID BMI99 COLSIG99 DTINT99 METREX99)
	  DER.SURVEY99FEMKEYVAR (KEEP=ID BMI99 COLSIG99 DTINT99 METREX99 HRTKIND99)

	  DER.SURVEY01FEMKEYVAR (KEEP=ID DTINT01 COLSIG01)
	  DER.SURVEY01MENKEYVAR (KEEP=ID DTINT01 COLSIG01)

	  DER.SURVEY03FEMKEYVAR (KEEP=ID DTINT03 COLSIG03)
	  DER.SURVEY03MENKEYVAR (KEEP=ID DTINT03 COLSIG03)

	  DER.SURVEY05FEMKEYVAR (KEEP=ID DTINT05)
	  DER.SURVEY05MENKEYVAR (KEEP=ID DTINT05)

      DER.SURVEY07FEMKEYVAR (KEEP=ID DTINT07)
      DER.SURVEY07MENKEYVAR (KEEP=ID DTINT07)

	  LLDRIV.LLWOMENDER_MASTER (IN=LIFELINK KEEP=ID DRAWDATE AGELL ANTIBILL)
	  LLDRIV.LLMENDER_MASTER   (IN=LIFELINK KEEP=ID DRAWDATE AGELL ANTIBILL)

      ORIG82.CPS2FEMORIGINAL   (KEEP=ID HT EDUCATE RACE ASPIRINX ASPIRINB HF ASTHMA)
      ORIG82.CPS2MENORIGINAL   (KEEP=ID HT EDUCATE RACE ASPIRINX ASPIRINB HF ASTHMA)

	  MAST.CPS2SMGMST14M	(KEEP=ID NUT_92 NUT_97 NUT_99 NUT_01 NUT_03 NUT_05 NUT_07 NUT_09)
	  MAST.CPS2SMGMST14F	(KEEP=ID NUT_92 NUT_97 NUT_99 NUT_01 NUT_03 NUT_05 NUT_07 NUT_09)

	  PYEAR.NUT92MENPYR1210 (KEEP=ID BDAYDATE DATEDD)
	  PYEAR.NUT92FEMPYR1210 (KEEP=ID BDAYDATE DATEDD)

	  CPS2DERV.CPS2MENKEYVAR3 (KEEP=ID FHCOCA82 PHCOCA82 SHCOCA82)
	  CPS2DERV.CPS2FEMKEYVAR3 (KEEP=ID FHCOCA82 PHCOCA82 SHCOCA82)

	  MORT.SMGMRT14d121220 (IN=INMORT) 
;

BY ID; 
IF INJB=1;

*DELETING PARTICIPANTS WHO REVOKED AUTHORIZATION TO PARTICIPATE, UNTIL MASTER FILE IS UPDATED WITH THIS INFO (NEXT MASTER FILE IS 15M AND 15F)*;
IF ID IN ('42341019003091','55096001012162','36041001003092','53036026007041') THEN DELETE;

*CASE ASCERTAINMENT*;
ASCERTAIN=DATASRC;
IF DATASRC=' ' THEN ASCERTAIN='D'; *DEATH ONLY CASES (N=23)*;

*CREATING SEX VARIABLE*;
IF M=1 THEN SEX=1; * MEN *;
ELSE SEX=0;        * WOMEN *;
FORMAT SEX SEX.;

*CREATING A NEW RACE VARIABLE: WHITE/BLACK/OTHER AND MISSING*;
IF RACE IN ('1','2') THEN RACENEW=1;
ELSE IF RACE IN ('3','4') THEN RACENEW=2;
ELSE RACENEW=3;
FORMAT RACENEW RACENEW.;

*YEARS BETWEEN DIAGNOSIS AND BLOOD DRAW*;
YEARDS = ROUND(INTCK('DAY',DRAWDATE,DXDATE)/(365.25+1/365.25), 0.01);
LABEL YEARDS = 'YEARS BETWEEN DIAGNOSIS AND BLOOD DRAW'; 

*AGE AT DIAGNOSIS*;
AGEDX = INTCK('YEAR', BDAYDATE, DXDATE); 
LABEL AGEDX = 'AGE AT DIAGNOSIS'; 

*** BODY MASS INDEX;
*** WHO CUTPOINTS FOR UNDER/NORMAL, OVERWEIGHT, OBESE;
IF .<BMI99<25.0 THEN BMIWHO=0;
ELSE IF 25.0<=BMI99<30.0 THEN BMIWHO=1;
ELSE IF 30.0<=BMI99 THEN BMIWHO=2;
ELSE IF BMI99=. THEN BMIWHO=9;
FORMAT BMIWHO BMIWHO.;

LABEL BMIWHO='Categorical BMI in 1999';

*CREATING EDUCATION VARIABLE*;
IF EDUCATE IN ('1','2') THEN EDUCA = 1;
ELSE IF EDUCATE IN ('3',' ') THEN EDUCA = 2;
ELSE IF EDUCATE IN ('4','5') THEN EDUCA = 3;
ELSE EDUCA = 4;
FORMAT EDUCA EDUCAF.;

*ALCOHOL CODE FROM ROMA*;
***ALCOHOL INTAKE - CONTINUOUS***;
		**1999**;
			*REGULAR BEER, LIGHT BEER, RED WINE, WHITE WINE & LIQUOR*;
				*--FREQUENCY = 0-9*;
			ARRAY T1  (5)  BEER99  BEERLT99  WINERE99  WINEWH99  LIQUOR99;
			ARRAY T2  (5)  BEER99X BEERLT99X WINERE99X WINEWH99X LIQUOR99X;
			DO I = 1 TO DIM(T1);
					 IF T1{I} = '0' THEN T2{I} = 0;    *NEVER;
				ELSE IF T1{I} = '1' THEN T2{I} = 0.02; *<1 SVG/MON;
				ELSE IF T1{I} = '2' THEN T2{I} = 0.07; *1-3 SVGS/MON;
				ELSE IF T1{I} = '3' THEN T2{I} = 0.14; *1 SVG/WK;
				ELSE IF T1{I} = '4' THEN T2{I} = 0.43; *2-4 SVGS/WK;
				ELSE IF T1{I} = '5' THEN T2{I} = 0.8;  *5-6 SVGS/WK;
				ELSE IF T1{I} = '6' THEN T2{I} = 1;    *1 SVG/D;
				ELSE IF T1{I} = '7' THEN T2{I} = 2.5;  *2-3 SVGS/D;
				ELSE IF T1{I} = '8' THEN T2{I} = 4.5;  *4-5 SVGS/D;
				ELSE IF T1{I} = '9' THEN T2{I} = 6;    *6+ SVGS/D;
				ELSE IF T1{I} IN (' ','.','*','I') THEN T2{I} = 0; *MISSING/INVALID CATEGORIZED AS NEVER;
			END;
			**1999 TOTAL ALCOHOL [SVGS/DAY]**;
				ALCOHOL99 = SUM(BEER99X,BEERLT99X,WINERE99X,WINEWH99X,LIQUOR99X);
				ALCOHOL99 = ROUND(ALCOHOL99,0.01); LABEL ALCOHOL99 = '1999 Total Alcohol (Drinks/D)';


***ALCOHOL INTAKE CATEGORIES***;
		*NOTE: CONDENSED CATEGORIES FROM SUE G.'S (NON-DRINKERS,<1 DRINK/D,1 DRINK/D,2+ DRINKS/D) TO THE FOLLOWING CATEGORIES
			   BECAUSE THERE WERE ONLY 5 CASES IN THE '1 DRINK/D' CATEGORY, SO COMBINED IT WITH '<1 DRINK/D' AS PER MARJI M.*;
		**1999**;
			 IF ALCOHOL99 = 0 	   THEN ALC99 = 1; *0 DRINKS/D, REF;
		ELSE IF 0 < ALCOHOL99 <= 1 THEN ALC99 = 2; *<=1 DRINK/D;
		ELSE IF 1 < ALCOHOL99 <= 6 THEN ALC99 = 3; *>1 DRINK/DAY;
								   ELSE ALC99 = 9; *MISSING/INVALID;
		LABEL ALC99 = '1999 Alcohol Intake (Drinks/D)'; FORMAT ALC99 ALC.;

*CREATING TIME VARIABLE FOR SPLINES*;
IF CACONEW=1 THEN TIME=1; 
ELSE IF CACONEW=0 THEN TIME=2; 

*MARITAL STATUS IN 1999*;
MAR_STAT=INPUT(MS99,1.);
IF MS99 IN ('3','4') THEN MAR_STAT=3;
ELSE IF MS99 ='5' THEN MAR_STAT=4;
ELSE IF MS99=' ' THEN MAR_STAT=9;

LABEL MAR_STAT="MARITAL STATUS IN 1999";
FORMAT MAR_STAT MSF.;


*FROM CHRISSY'S CODE - G:\Analytic Epidemiology Analysts\Published Analysis Documentation\Campbell_2010_GASTRO_Diabetes & insulin and CRC\Folder 2 - 
	Programs and Outputs\SAS Programs and Outputs\COHORT 2-26-10.SAS;

	***TIME-DEPENDENT FAMILY HISTORY OF CRC***;

		**1982**;
		IF FHCOCA82=1 OR PHCOCA82 IN (1,2) OR SHCOCA82 IN (1,2,3,4,5,6) THEN FAMHX82N=1;
		ELSE FAMHX82N=0;

		**1992**; *(FAM HX NOT ASKED IN 92)*;
		FAMHX92N=FAMHX82N;

		**1997**;
		IF FMHXCR97=1 THEN FAMHX97N=1;
		ELSE IF FAMHX92N=1 THEN FAMHX97N=1;
		ELSE FAMHX97N=0;

		**1999**; *(FAM HX NOT ASKED IN 99)*;
		FAMHX99N=FAMHX97N;
		LABEL FAMHX99N='FAMILY HISTORY OF CRC 99';

***CRC SCREENING***;

*FOLLOW-UP FOR CRC SCREENING HISTORY BEGAN IN 1997;
*MODIFYING CHRISSY'S CODE TO ONLY INCLUDE SCREENINGS PRIOR TO DX*;

**EVER/NEVER**;

****1997****;
IF EVRSIG97='0' THEN SCREEN97=0;
ELSE IF EVRSIG97 IN ('1') THEN SCREEN97=1;
ELSE IF EVRSIG97 IN ('8','9','S') THEN SCREEN97=9;
ELSE SCREEN97=9;

LABEL SCREEN97='SCREENING 1997';

*****1997--1999******;
IF COLSIG99='1' THEN DO;
	IF SCREEN97=0 THEN SCREEN99=0; /*NOT SCREENED PRIOR TO 1997*/
	ELSE IF SCREEN97=1 THEN SCREEN99=1; /*SCREENED AS OF 1997*/
	ELSE IF SCREEN97=9 THEN SCREEN99=9; /*UNK AS OF 1997*/
END;
ELSE IF COLSIG99 IN (' ','7','8','9') THEN DO;
	IF SCREEN97=1 THEN SCREEN99=1; /*SCREENED PRIOR*/
	ELSE SCREEN99=9; /*EITHER NOT SCREENED OR UNK PRIOR*/
END;
ELSE IF COLSIG99 IN ('3') THEN SCREEN99=1; *SCREENED DURING A ROUTINE VISIT - ALTERED BY JB*;
ELSE IF COLSIG99 IN ('2','4') THEN SCREEN99=0; *SETTING OBS THAT HAD SYMPTOM SCREENING TO 0 - ALTERED BY JB*;

LABEL SCREEN99='EVER/NEVER SCREENING 1999';
FORMAT SCREEN99 YESNOF.;

*RECENT SCREENING*;

****1999****;
IF COLSIG99 IN ('1','2','4') THEN RSCREEN99=0; *SETTING OBS THAT HAD SYMPTOM SCREENING TO 0*;
ELSE IF COLSIG99='3' THEN RSCREEN99=1;
ELSE RSCREEN99=9; 

LABEL RSCREEN99='RECENT (IN PAST 2 YRS) SCREENING 1999'; 
FORMAT RSCREEN99 YESNOF.;

*MEAT INTAKE CODE FROM ROMA*;
*NOTE: 1. We decided not to include chicken/turkey hotdogs in the combined variable, and only in the separate processed 
meat variable. Incase you want to include it in the total meat intake, that variable is “CHHDOG99X” below.
	2.	We coded missing intake as “0”.;

****RED/PROCESSED MEATS IN 1999****;
      **NOTE: DIFFERENT ARRAYS BECAUSE VARIABLES HAVE DIFFERENT FREQUENCIES (OF ANSWERS). ALSO, DAILY FREQUENCY
                  CONVERSIONS FROM WILLETT DOCUMENTATION IN CPS FOLDER IN S: DRIVE (DOUBLE-CHECKED WITH MARJI M.)**;
      **BEEF/PORK HOT DOGS, PROC MEATS (SAUSAGE/KIELBASA/ETC) AND CHICKEN/TURKEY HOT DOGS**;
      *--FREQUENCY = 0-7*;
      ARRAY B1  (3)  BEHDOG99   MEATS99   CHHDOG99;
      ARRAY B2  (3)  BEHDOG99J  MEATS99J  CHHDOG99J;
      ARRAY B3  (3)  BEHDOG99X  MEATS99X  CHHDOG99X;
      DO I = 1 TO DIM(B1);
                  IF B1{I} = '0' THEN B2{I} = 0;    *NEVER;
            ELSE IF B1{I} = '1' THEN B2{I} = 0.02; *<1 SVG/MO;
            ELSE IF B1{I} = '2' THEN B2{I} = 0.07; *1-3 SVGS/MO;
            ELSE IF B1{I} = '3' THEN B2{I} = 0.14; *1 SVG/WK;
            ELSE IF B1{I} = '4' THEN B2{I} = 0.43; *2-4 SVGS/WK;
            ELSE IF B1{I} = '5' THEN B2{I} = 0.8;  *5-6 SVGS/WK;
            ELSE IF B1{I} = '6' THEN B2{I} = 1;    *1 SVG/D;
            ELSE IF B1{I} = '7' THEN B2{I} = 2;    *2+ SVGS/D;
            ELSE IF B1{I} IN ('.',' ','*','I') THEN B2{I} = .; *MISSING/INVALID;
      END;
      DO I = 1 TO DIM(B2); *SETTING MISSING VALUES TO 0 (WILL USE THE 'J' SUFFIX VARS BELOW FOR EXCLUSION BASED ON MISSING MEAT);
            B3{I} = B2{I};
            IF B2{I} = . THEN B3{I} = 0;
      END;
      **BACON, REGULAR HAMBURGER, LEAN HAMBURGER, BEEF/PORK/LAMB AS SANDWICH, BEEF/LAMB AND PORK**;
      *--FREQUENCY = 0-6*;
      ARRAY C1  (6)  BACON99   HAMREG99   HAMLEA99   BESAND99   BEEF99   PORK99;
      ARRAY C2  (6)  BACON99J  HAMREG99J  HAMLEA99J  BESAND99J  BEEF99J  PORK99J;
      ARRAY C3  (6)  BACON99X  HAMREG99X  HAMLEA99X  BESAND99X  BEEF99X  PORK99X;
      DO I = 1 TO DIM(C1);
                  IF C1{I} = '0' THEN C2{I} = 0;    *NEVER;
            ELSE IF C1{I} = '1' THEN C2{I} = 0.02; *<1 SVG/MO;
            ELSE IF C1{I} = '2' THEN C2{I} = 0.07; *1-3 SVGS/MO;
            ELSE IF C1{I} = '3' THEN C2{I} = 0.14; *1 SVG/WK;
            ELSE IF C1{I} = '4' THEN C2{I} = 0.43; *2-4 SVGS/WK;
            ELSE IF C1{I} = '5' THEN C2{I} = 0.8;  *5-6 SVGS/WK;
            ELSE IF C1{I} = '6' THEN C2{I} = 1;    *1 SVG/D;
            ELSE IF C1{I} IN (' ','.','*','I') THEN C2{I} = .; *MISSING/INVALID;
      END;
      DO I = 1 TO DIM(C2); *SETTING MISSING VALUES TO 0 (WILL USE THE 'J' SUFFIX VARS BELOW FOR EXCLUSION BASED ON MISSING MEAT);
            C3{I} = C2{I};
            IF C2{I} = . THEN C3{I} = 0;
      END;
      **SALAMI/BOLOGNA/OTHER MEAT SANDWICH**;
      *--FREQUENCY = 0-5*;
      ARRAY D1  (1)  SALAMI99;
      ARRAY D2  (1)  SALAMI99J;
      ARRAY D3  (1)  SALAMI99X;
      DO I = 1 TO DIM(D1);
                  IF D1{I} = '0' THEN D2{I} = 0;    *NEVER;
            ELSE IF D1{I} = '1' THEN D2{I} = 0.02; *<1 SVG/MO;
            ELSE IF D1{I} = '2' THEN D2{I} = 0.07; *1-3 SVGS/MO;
            ELSE IF D1{I} = '3' THEN D2{I} = 0.14; *1 SVG/WK;
            ELSE IF D1{I} = '4' THEN D2{I} = 0.43; *2-4 SVGS/WK;
            ELSE IF D1{I} = '5' THEN D2{I} = 0.71; *5+ SVGS/WK;
            ELSE IF D1{I} IN (' ','.','*','I') THEN D2{I} = .; *MISSING/INVALID;
      END;
      DO I = 1 TO DIM(D2); *SETTING MISSING VALUES TO 0 (WILL USE THE 'J' SUFFIX VARS BELOW FOR EXCLUSION BASED ON MISSING MEAT);
            D3{I} = D2{I};
            IF D2{I} = . THEN D3{I} = 0;
      END;
      **BEEF/CALF/PORK LIVER AND CHICKEN/TURKEY LIVER**;
      *--FREQUENCY = 0-4*;
      ARRAY E1  (2)  BELIVR99   CHLIVR99;
      ARRAY E2  (2)  BELIVR99J  CHLIVR99J;
      ARRAY E3  (2)  BELIVR99X  CHLIVR99X;
      DO I = 1 TO DIM(E1);
                  IF E1{I} = '0' THEN E2{I} = 0;    *NEVER;
            ELSE IF E1{I} = '1' THEN E2{I} = 0.02; *<1 SVG/MO;
            ELSE IF E1{I} = '2' THEN E2{I} = 0.03; *1 SVG/MO;
            ELSE IF E1{I} = '3' THEN E2{I} = 0.14; *2-3 SVGS/MO;
            ELSE IF E1{I} = '4' THEN E2{I} = 0.43; *1+ SVGS/WK;
            ELSE IF E1{I} IN (' ','.','*','I') THEN E2{I} = .; *MISSING/INVALID;
      END;
      DO I = 1 TO DIM(E2); *SETTING MISSING VALUES TO 0 (WILL USE THE 'J' SUFFIX VARS BELOW FOR EXCLUSION BASED ON MISSING MEAT);
            E3{I} = E2{I};
            IF E2{I} = . THEN E3{I} = 0;
      END;
      **1999 RED/PROCESSED MEAT (SVGS/WK, NO CHICKEN/TURKEY HOT DOGS IN COMBINED, AS PER MARJI M.) - USING 'X' SUFFIX VARS**;
      MEAT99 = (SUM(BACON99X,BEHDOG99X,SALAMI99X,MEATS99X,HAMREG99X,HAMLEA99X,BESAND99X,PORK99X,BEEF99X,BELIVR99X,CHLIVR99X))*7;
      MEAT99 = ROUND(MEAT99,0.01);
      **1999 [FRESH] RED MEAT (SVGS/WK), AS PER MARJI M. - USING 'X' SUFFIX VARS**;
      RED99 = (SUM(HAMREG99X,HAMLEA99X,BESAND99X,PORK99X,BEEF99X,BELIVR99X,CHLIVR99X))*7;
      RED99 = ROUND(RED99,0.01);
      **1999 PROCESSED MEAT (SVGS/WK, INCLUDE CHICKEN/TURKEY HOT DOGS HERE), AS PER MARJI M. - USING 'X' SUFFIX VARS**;
      PROC99 = (SUM(BACON99X,BEHDOG99X,SALAMI99X,MEATS99X,CHHDOG99X))*7;
      PROC99 = ROUND(PROC99,0.01);
      LABEL MEAT99 = '1999 Red/Proc Meat Intake (Svgs/Wk)'
               RED99 = '1999 [Fresh] Red Meat Intake (Svgs/Wk)'
              PROC99 = '1999 Proc Meat Intake (Svgs/Wk)';

*CATEGORICAL MEAT VARIABLE*;
IF MEAT99=0 THEN MEAT99_CAT=0;
ELSE IF 0<MEAT99<7 THEN MEAT99_CAT=1;
ELSE IF MEAT99>=7 THEN MEAT99_CAT=2;

LABEL MEAT99_CAT="MEAT INTAKE (SERVINGS/DAY)";
FORMAT MEAT99_CAT MEATF.;


*ADDING COVARIATES FROM MEIRA EPPLEIN'S LIST - 7/7/14*;
*CRC SCREENING (EVER, POLYP, RECENCY), CURRENT ANTIBIOTIC USE, SMOKING STATUS AND PACK-YEARS, ASPIRIN (REG USE, DURATION, DOSE, RECENCY), PA (METS) - USE METREX99 VARIABLE, 
HRT (STATUS, RECENCY) AND IBD (EVER)*;

*CURRENT ANTIBIOTIC USE AT TIME OF LL*;
IF ANTIBILL='1' THEN ANTIB99=0;
ELSE IF ANTIBILL='2' THEN ANTIB99=1;
ELSE ANTIB99=9;

LABEL ANTIB99="ANTIBIOTIC USE IN 1999";
FORMAT ANTIB99 YESNOF.;


*RECENT POLYPS IN 1999*;
IF COLPOL99='1' THEN RCOLPOL99=0; *NEVER*;
ELSE IF COLPOL99='2' THEN RCOLPOL99=1; *BEFORE OCTOBER 1997*;
ELSE IF COLPOL99='3' THEN RCOLPOL99=2; *OCT 1997-SEPT 1999*;
ELSE IF COLPOL99='4' THEN RCOLPOL99=3; *AFTER SEPT 1999*;
ELSE RCOLPOL99=9; *MISSING AND INVALID VALUES*;

LABEL RCOLPOL99="RECENT POLYPS IN 1999";
FORMAT RCOLPOL99 POL99F.;

*PHYSICAL ACTIVITY*;
IF METREX99=0 THEN PA99=0;
ELSE IF METREX99 GT 0 AND METREX99 LT 7.5 THEN PA99=1;
ELSE IF METREX99 GE 7.5 THEN PA99=2;
ELSE IF METREX99=. THEN PA99=9; 

LABEL PA99="PHYSICAL ACTIVITY IN 1999";
FORMAT PA99 PAF.;

*	HRT STATUS	*;
*HRT VARIABLES FROM JANET'S SITTING AND CANCER ANALYSIS*;

	*******HRT TYPE AND STATUS IN 1992*******************************;
	*  HRT6GRP  0=NEVER USER                      			    	*;
	*			1=CURRENT ERT USER									*;
	*			2=FORMER ERT USER 									*;
	*			3=CURRENT CHRT USER 								*;
	*			4=FORMER CHRT USER                                  *;
	*			9=OTHER/UNKNOWN										*;
	*****************************************************************;

	IF HRTKIND92M=0 THEN HRT6GRP92=0;
	ELSE IF HRTKIND92M=1 THEN HRT6GRP92=1;
	ELSE IF HRTKIND92M=2 THEN HRT6GRP92=2;
	ELSE IF HRTKIND92M=4 THEN HRT6GRP92=3;
	ELSE IF HRTKIND92M=5 THEN HRT6GRP92=4;
	ELSE IF HRTKIND92M IN (7,8,9) THEN HRT6GRP92=9;
	ELSE IF HRTKIND92M IN (3,6,10) THEN HRT6GRP92=9;
	ELSE IF HRTKIND92M IN (96,97,98,99) THEN HRT6GRP92=9;
	ELSE IF HRTKIND92M=11 THEN HRT6GRP92=9;
	ELSE IF HRTKIND92M=12 THEN HRT6GRP92=9;


	******CREATE HRT6GRP97: HRT TYPE AND STATUS IN 1997***********;
	*     	0=NEVER USER 1997                  			    	*;
	*		1=CURRENT ERT USER 1997								*;
	*		2=FORMER ERT USER 1997								*;
	*		3=CURRENT CHRT USER 1997							*;
	*		4=FORMER CHRT USER 1997								*;
	*		9=OTHER/UNKNOWN										*;
	*************************************************************;

	*******DERIVE TYPE OF EVER USE, USING 1997 RAW VARIABLES********;
	ERTEV97=0; CHRTEV97=0;
	IF ESPR97='1' OR ONE97='1' OR ESPRYR97>=0 OR ONEYR97>=0 THEN CHRTEV97=1;  /*EVER USED CHRT*/
	IF ESTR97='1' OR ESTRYR97>=0 THEN ERTEV97=1;  /*EVER USED ERT*/
	 
	********CATEGORICAL VARIABLE FOR HRT TYPE IN 1997**************;
	IF NUT_97=0 THEN HRT6GRP97=9;
	ELSE IF CHRTEV97=1 AND ERTEV97=1 THEN HRT6GRP97=9;
	ELSE IF HRTKIND97=0 THEN DO;
		IF HRT6GRP92=0 THEN HRT6GRP97=0;
		ELSE IF HRT6GRP92 IN (1,2) THEN HRT6GRP97=2;
		ELSE IF HRT6GRP92 IN (3,4) THEN HRT6GRP97=4;
		ELSE HRT6GRP97=9;
	END;
	ELSE IF HRTKIND97=1 THEN HRT6GRP97=1;
	ELSE IF HRTKIND97=2 THEN HRT6GRP97=2;
	ELSE IF HRTKIND97=4 THEN HRT6GRP97=3;
	ELSE IF HRTKIND97=5 THEN HRT6GRP97=4;
	ELSE IF HRTKIND97=97 THEN DO;
		IF HRT6GRP92=1 THEN HRT6GRP97=1;
		ELSE IF HRT6GRP92=3 THEN HRT6GRP97=3;
		ELSE IF CHRTEV97=1 THEN HRT6GRP97=3;
		ELSE IF ERTEV97=1 THEN HRT6GRP97=1;
		ELSE HRT6GRP97=9;
	END;
	ELSE IF HRTKIND97=98 THEN DO;
		IF HRT6GRP92 IN (1,2) THEN HRT6GRP97=2;
		ELSE IF HRT6GRP92 IN (3,4) THEN HRT6GRP97=4;
		ELSE HRT6GRP97=9;
	END;
	ELSE IF HRTKIND97 IN (96,99) THEN HRT6GRP97=9;
	ELSE IF HRTKIND97=9 THEN HRT6GRP97=9;
	ELSE IF HRTKIND97 IN (3,6,10) THEN HRT6GRP97=9;
	ELSE IF HRTKIND97=11 THEN HRT6GRP97=9;
	ELSE IF HRTKIND97=12 THEN HRT6GRP97=9;

	******CREATE HRT6GRP99: HRT TYPE AND STATUS IN 1999**************************;
	*     	0=NEVER USER 1999                  			    					*;
	*		1=ERT USE INTERVAL 1997--1999										*;
	*		2=FORMER ERT USER (BEFORE 1997-DERIVED FROM HRT6GRP92 & HRT6GRP97)	*;
	*		3=CHRT USER 1997--1999  											*;
	*		4=FORMER CHRT USER 1997	(BEFORE 1997-FROM HRT6GRP92 & HRT6GRP97)	*;								
	*		9=OTHER/UNKNOWN														*;
	*****************************************************************************;

	IF NUT_99=0 THEN HRT6GRP99=9;
	ELSE IF HRTKIND99='0' THEN DO;
		IF HRT6GRP97=0 THEN HRT6GRP99=0;
		ELSE IF HRT6GRP97 IN (1,2) THEN HRT6GRP99=2;
		ELSE IF HRT6GRP97 IN (3,4) THEN HRT6GRP99=4;
		ELSE HRT6GRP99=9;
	END;
	ELSE IF HRTKIND99='1' THEN HRT6GRP99=1;
	ELSE IF HRTKIND99='2' THEN HRT6GRP99=3;
	ELSE IF HRTKIND99 IN ('5','8','9') THEN HRT6GRP99=9;
	ELSE IF HRT6GRP92 IN (1,2) AND HRT6GRP97 IN (1,2) THEN HRT6GRP99=2;
	ELSE IF HRT6GRP92 IN (3,4) AND HRT6GRP97 IN (3,4) THEN HRT6GRP99=4;
	ELSE IF HRTKIND99='3' THEN HRT6GRP99=9;
	ELSE IF HRTKIND99='4' THEN HRT6GRP99=9;
	ELSE IF SEX=1 THEN HRT6GRP99=0; *ADDING MEN TO THE NEVER USER GROUP PER R. DIVER - 11/4/14*;

LABEL HRT6GRP99="POSTMENOPAUSAL HORMONE THERAPY IN 1999";

*PER BRIAN: TO GET PACK-YEARS - CIGARETTES PER DAY*DURATION (ONLY DO FOR CURRENT SMOKERS, NOT FORMER SMOKERS)*;
*USE COVARIATES STAT99 (SMOKING STATUS), DUR99N (SMOKING DURATION FOR CURRENT AND FORMER SMOKERS) AND CPD99N FOR CIGARETTES PER DAY (ONLY FOR CURRENT SMOKERS)*;
*FROM BRIAN: You can't use cigarettes per day in former smokers because they don't have that variable, because they aren't smoking.  Total duration of smoking should be coded 
for them... I'm not really sure though because I never actually used duration of smoking in former smokers, but I think I calculated it anyways and just added 0 years for every
survey cycle that they remained non-smokers.*;

 ***************************************************
*												   *
*		CPS-II NUTRITION COHORT					   *
*			DATA SUBSET FOR						   *
*   	PARALLEL AND POOLED SMOKING ANALYSIS	   *
*												   *
*		BRIAN CARTER							   *
*												   *
 ***************************************************;

*************************************
* 			DATES					*
*************************************;


ENROLLMENT_YEAR = YEAR(DTINT92);

ENROLLMENT_AGE = ROUND(((DTINT92-BDAYDATE)/365.25)*12);

YEAR_FIRST = ENROLLMENT_YEAR;

***********************************;
* 1992 SMOKING VARIABLES		  *;
***********************************;

IF SMK92 = '1' THEN STAT92='1';						 *NEVER*;
	ELSE IF SMK92 IN('2','4') THEN STAT92 = '2';	 *CURRENT*;
	ELSE IF SMK92 IN('3','5') THEN STAT92 = '3';	 *FORMER*;
	ELSE IF SMK92 ='6' THEN STAT92 = '4';			 *EVER*;
	ELSE STAT92 = '9';

CPD_FIRST = CPD92;

YEARS_SMOKE_FIRST = SMKYRS92; 			

AGE_INITIATION = AGESMK92;

SMOKE_DURATION = .;

AGE_QUIT = AGEQT92;

*************************;
* SMOKING STATUS AT UPDATES;
*************************;

**********************************
*	1: NEVER SMOKER					*
*	2: CURRENT SMOKER					*
*	3: FORMER SMOKER					*
*	9: MISSING							*
**********************************;


***** STATUS 1997 *****;

IF SMK97 IN(' ','8','9') THEN STAT97 = '9';
	ELSE STAT97 = SMK97;

***** CLEAN 1997 SMOKING STATUS *****;

IF STAT97 = '1' THEN DO;
	IF STAT92 IN('2','3','4') THEN STAT97 = '3';
	ELSE IF STAT92 = '9' THEN STAT97 = '4';
	END;


***** STATUS 1999 *****;

IF CIGNOW99 = '2' THEN STAT99 = '2';		*CURRENT SMOKER*;
	ELSE IF CIGNOW99 IN('*',' ') OR NUT_99 = '0' THEN STAT99 ='9';		* MISSING *;
	ELSE IF CIGNOW99 = '1' THEN DO;
		IF STAT97 = '1'
			AND STAT92 = '1'
				THEN STAT99 = '1';		* ALWAYS NEVER SMOKERS *;
		ELSE IF STAT97 IN('2','3')
			OR STAT92 IN('2','3','4')
				THEN STAT99 = '3';	* EVER SMOKERS - NOT CURRENT *;
		ELSE STAT99 = '4';	* MISSING SMOKING INFO AT SOME POINT *;
		END;


***** STATUS 2001 *****;

IF CIGNOW01 = '2' THEN STAT01 = '2';	 * CURRENT SMOKER *;
	ELSE IF CIGNOW01 IN('*',' ') OR NUT_01 = '0' THEN STAT01 ='9';		* MISSING *;
	ELSE IF CIGNOW01 = '1' THEN DO;
		IF STAT99 = '1'
			AND STAT97 = '1'
				AND STAT92 = '1'
					THEN STAT01 = '1';		* ALWAYS NEVER SMOKERS *;
	ELSE IF STAT99 IN('2','3')
		OR STAT97 IN('2','3')
			OR STAT92 IN('2','3','4')
				THEN STAT01 = '3';	* EVER SMOKERS - NOT CURRENT *;
	ELSE STAT01 = '4';	* MISSING SMOKING INFO AT SOME POINT *;
		END;


***** STATUS 2003 *****;
IF CIGNOW03 = '2' THEN STAT03 = '2';	 * CURRENT SMOKER *;
	ELSE IF CIGNOW03 IN('*',' ') OR NUT_03 = '0' THEN STAT03 ='9';		* MISSING *;
	ELSE IF CIGNOW03 = '1' THEN DO;
		IF STAT01 = '1'
		   AND STAT99 = '1'
				AND STAT97 = '1'
					AND STAT92 = '1'
						THEN STAT03 = '1';		* ALWAYS NEVER SMOKERS *;
	ELSE IF STAT01 IN('2','3')
		OR STAT99 IN('2','3')
			OR STAT97 IN('2','3')
				OR STAT92 IN('2','3','4')
					THEN STAT03 = '3';	* EVER SMOKERS - NOT CURRENT *;
	ELSE STAT03 = '4';	* MISSING SMOKING INFO AT SOME POINT *;
		END;


***** STATUS 2005 *****;

IF CIGNOW05 = '2' THEN STAT05 = '2';	 * CURRENT SMOKER *;
	ELSE IF CIGNOW05 IN('*',' ') OR NUT_05 = '0' THEN STAT05 ='9';		* MISSING *;	
	ELSE IF CIGNOW05 = '1' THEN DO;
		IF STAT03 = '1'
			AND STAT01 = '1'
		   	AND STAT99 = '1'
					AND STAT97 = '1'
						AND STAT92 = '1'
							THEN STAT05 = '1';		* ALWAYS NEVER SMOKERS *;
	ELSE IF STAT03 IN('2','3')
		OR STAT01 IN('2','3')
			OR STAT99 IN('2','3')
				OR STAT97 IN('2','3')
					OR STAT92 IN('2','3','4')
						THEN STAT05 = '3';	* EVER SMOKERS - NOT CURRENT *;
	ELSE STAT05 = '4';	* MISSING SMOKING INFO AT SOME POINT *;
		END;


***** STATUS 2007 *****;

IF CIGNOW07 = '2' THEN STAT07 = '2';	 * CURRENT SMOKER *;
	ELSE IF CIGNOW07 IN('*',' ') OR NUT_07 = '0' THEN STAT07 ='9';		* MISSING *;	
	ELSE IF CIGNOW07 = '1' THEN DO;
		IF STAT05 = '1'
               AND STAT03 = '1'
			AND STAT01 = '1'
		   	AND STAT99 = '1'
					AND STAT97 = '1'
						AND STAT92 = '1'
							THEN STAT07 = '1';		* ALWAYS NEVER SMOKERS *;
	ELSE IF STAT05 IN('2','3')
          OR STAT03 IN('2','3')
		OR STAT01 IN('2','3')
		OR STAT99 IN('2','3')
		OR STAT97 IN('2','3')
		OR STAT92 IN('2','3','4')
						THEN STAT07 = '3';	* EVER SMOKERS - NOT CURRENT *;
	ELSE STAT07 = '4';	* MISSING SMOKING INFO AT SOME POINT *;
		END;


********************
CIGARETTES PER DAY - UPDATES;
********************;
CPD_UPDATE_CAT_97 = PUT(CIGNUM97,1.);
CPD_UPDATE_CAT_99 = PUT(CIGNUM99,1.);
CPD_UPDATE_CAT_01 = PUT(CIGNUM01,1.);
CPD_UPDATE_CAT_03 = PUT(CIGNUM03,1.);
CPD_UPDATE_CAT_05 = PUT(CIGNUM05,1.);
CPD_UPDATE_CAT_07 = PUT(CIGNUM07,1.);


*** CLEAN UP SMOKING STATUS ***;

*********************************;
*	1="NEVER SMOKER"			*;
*	2="CURRENT"					*;
*	3="FORMER"					*;
*	4="EVER - CURRENT UNKNOWN"	*;
*	9="MISSING"					*;
*********************************;

ARRAY NEW(*) $ STAT92 STAT97 STAT99 STAT01 STAT03 STAT05 STAT07;

DO I=1 TO DIM(NEW);
	IF NEW(I)='4' THEN NEW(I)='9';
	END;

FORMAT STAT99 STATF.;

*** CIGARETTES PER DAY AT FIRST SURVEY ***;

IF STAT92 IN('2','3') THEN DO;
	IF 0<=CPD_FIRST<10 THEN CPD92=1;
	ELSE IF 10<=CPD_FIRST<20 THEN CPD92=2;
	ELSE IF 20<=CPD_FIRST<40 THEN CPD92=3;
	ELSE IF 40<=CPD_FIRST THEN CPD92=4;
	END;


***** CURRENT WITH CONSEQUTIVE MISSINGS *****;
 * ASSIGNED THE PREVIOUS SURVEY'S STATUS, CUTOFF BEFORE THE BEGINNING OF THE NEXT SURVEY CYCLE *;

* CEN97 CUTOFF AT 12/31/1999 *;
* CEN99 CUTOFF AT 12/31/2001 *;
* CEN01 CUTOFF AT 10/31/2003 *;
* CEN03 CUTOFF AT 10/31/2005 *;
* CEN05 CUTOFF AT 10/31/2007 *;
* CEN07 CUTOFF AT 10/31/2009 *;

CEN97='0'; CEN99='0'; CEN01='0'; CEN03='0'; CEN05='0';

	IF STAT92='2' AND STAT97='9' AND STAT99='9' THEN DO;
		STAT97='2'; STAT99='2'; 
		CEN97='1';
		END;

		*1997*;

	ELSE IF STAT97='2' AND STAT99='9' AND STAT01='9' THEN DO;
		STAT99='2'; STAT01='2'; STAT03='10';
		CEN99='1'; 
		END;

		*1999*;

	ELSE IF STAT99='2' AND STAT01='9' AND STAT03='9' THEN DO;
		STAT01='2'; STAT03='2'; ;
		CEN01='1'; 
		END;

		*2001*;

	ELSE IF STAT01='2' AND STAT03='9' AND STAT05='9' THEN DO;
		STAT03='2'; STAT05='2';
		CEN03='1';
		END;

		*2003*;

	ELSE IF STAT03='2' AND STAT05='9' AND STAT07='9' THEN DO;
		STAT05='2'; STAT07='2';
		CEN05='1';
		END;

		*2005*;

	ELSE IF STAT05='2' AND STAT07='9' AND STAT09='9' THEN DO;
		STAT07='2'; STAT09='2';
		CEN07='1';
		END;

******************* *;
* SMOKING DURATION  *;
* total duration 	*;
*  calculated for 	*;
*  current/former 	*;
*********************;

*****************************************************;
* GENERATE MEAN DATE FOR MISSING DTINT VALUES 		*;
*													*;
*	 FOR MISSING SURVEYS USUAL CENSOR DATE CHOSEN 	*;
* 	FOR REMAINING SURVEYS WAS CHOSEN AS A PROXY		*;
*													*;
*****************************************************;


**** THE 1999 DURATION VARIABLE WAS USED IN THE 'BASELINE' VALUE FOR TABLE 1 *;
* THE 1999-2005 VALUES WERE USED IN SUPPLEMNTARY TABLES, NOT THE MAIN ANALYSIS *;

DTINT92A=DTINT92;
IF DTINT97=. THEN DTINT97A=13879;
	ELSE DTINT97A=DTINT97;
IF DTINT99=. THEN DTINT99A=14609;
	ELSE DTINT99A=DTINT99;
IF DTINT01=. THEN DTINT01A=15340;
	ELSE DTINT01A=DTINT01;
IF DTINT03=. THEN DTINT03A=15279;
	ELSE DTINT03A=DTINT03;
IF DTINT05=. THEN DTINT05A=16740;
	ELSE DTINT05A=DTINT05;
IF DTINT07=. THEN DTINT07A=MDY(10,31,07);
     ELSE DTINT07A=DTINT07;

AGE_INT=FLOOR(ENROLLMENT_AGE/12);

AGE92=FLOOR((DTINT92A-BDAYDATE)/365.25);
AGE97=FLOOR((DTINT97A-BDAYDATE)/365.25);
AGE99=FLOOR((DTINT99A-BDAYDATE)/365.25);
AGE01=FLOOR((DTINT01A-BDAYDATE)/365.25);
AGE03=FLOOR((DTINT03A-BDAYDATE)/365.25);
AGE05=FLOOR((DTINT05A-BDAYDATE)/365.25);
AGE07=FLOOR((DTINT07A-BDAYDATE)/365.25);

	
*** TABULATE TOTAL DURATION FOR ALL INDIVIDUALS  ***;

*** DURATION 1992 ***;

IF YEARS_SMOKE_FIRST IN(.M,.U) THEN YEARS_SMOKE_FIRST=.;
DUR92=YEARS_SMOKE_FIRST; *CONTINUOUS VARIABLE 0-99 YEARS *;

IF STAT92='1' THEN DUR92=0;


*** DURATION 1997 ***;
IF STAT97='1' THEN DUR97=DUR92;

*** FORMER SMOKERS ***;

ELSE IF STAT97='3' THEN DO;
	IF STAT92='3' THEN DO;
		DUR97=DUR92; *** CONTINUOUS FORMER SMOKERS ***;
		AGE_INI_97=AGE_INITIATION;
		END;
	ELSE IF STAT92='2' THEN DO;     *** RECENTLY QUIT SMOKING ***;
		DUR97= DUR92 + ((DTINT97A-DTINT92A)/365.25)/2;	* QUIT DATE MIDPOINT BETWEEN 97 AND 92 *;
		AGE_INI_97=AGE_INITIATION;
		END;
	ELSE IF STAT92='1' THEN DO;
		DUR97= ((DTINT97A-DTINT92A)/365.25)/2; * STARTED AND QUIT OVER THE INTERVAL *;
		AGE_INI_97=AGE97-DUR97;
		END;
END;

*** CURRENT SMOKERS ***;

ELSE IF STAT97='2' THEN DO;
	IF STAT92='2' THEN DO;			*** CONTINUOUS CURRENT SMOKERS - PREVIOUS DURATION + INTERVAL ***;
		DUR97=DUR92 + (DTINT97A-DTINT92A)/365.25;
		AGE_INI_97=AGE_INITIATION;
		END;
	ELSE IF STAT92='3' THEN DO;		*** CURRENT SMOKERS WHO WERE FORMER - PREVIOUS DURATION + HALF THE INTERVAL ***;
		DUR97= DUR92+(((DTINT97A-DTINT92A)/365.25)/2);
		AGE_INI_97=AGE_INITIATION;
		END;
	ELSE IF STAT92='1' THEN DO;		*** CURRENT SMOKERS WHO WERE NEVER PREVIOUS DURATION + HALF THE INTERVAL ***;
		DUR97= DUR92+(((DTINT97A-DTINT92A)/365.25)/2);
		AGE_INI_97=AGE97-DUR97;
		END;
END;


*** DURATION 1999 ***;
IF STAT99='1' THEN DUR99=DUR97;

*** FORMER SMOKERS ***;

ELSE IF STAT99='3' THEN DO;
	IF STAT97='3' THEN DO;
		DUR99=DUR97; *** CONTINUOUS FORMER SMOKERS ***;
		AGE_INI_99=AGE_INI_97;
		END;
	ELSE IF STAT97='2' THEN DO;     *** RECENTLY QUIT SMOKING ***;
		DUR99= DUR97 + ((DTINT99A-DTINT97A)/365.25)/2;
		AGE_INI_99=AGE_INI_97;
		END;
	ELSE IF STAT97='1' THEN DO;
		DUR99= ((DTINT99A-DTINT97A)/365.25)/2;
		AGE_INI_99=AGE99-DUR99;
		END;
END;

*** CURRENT SMOKERS ***;

ELSE IF STAT99='2' THEN DO;
	IF STAT97='2' THEN DO;			*** CONTINUOUS CURRENT SMOKERS ***;
		DUR99=DUR97 + (DTINT99A-DTINT97A)/365.25;
		AGE_INI_99=AGE_INI_97;
		END;
	ELSE IF STAT97='3' THEN DO;		*** CURRENT SMOKERS WHO WERE FORMER ***;
		DUR99= DUR97+(((DTINT99A-DTINT97A)/365.25)/2);
		AGE_INI_99=AGE_INI_97;
		END;
	ELSE IF STAT97='1' THEN DO;		*** CURRENT SMOKERS WHO WERE NEVER ***;
		DUR99= DUR97+(((DTINT99A-DTINT97A)/365.25)/2);
		AGE_INI_99=AGE99-DUR99;
		END;
END;



*** DURATION 2001 ***;
IF STAT01='1' THEN DUR01=DUR99;

*** FORMER SMOKERS ***;

ELSE IF STAT01='3' THEN DO;
	IF STAT99='3' THEN DO;
		DUR01=DUR99; *** CONTINUOUS FORMER SMOKERS ***;
		AGE_INI_01=AGE_INI_99;
		END;
	ELSE IF STAT99='2' THEN DO;     *** RECENTLY QUIT SMOKING ***;
		DUR01= DUR99 + ((DTINT01A-DTINT99A)/365.25)/2;
		AGE_INI_01=AGE_INI_99;
		END;
	ELSE IF STAT99='1' THEN DO;
		DUR01= ((DTINT01A-DTINT99A)/365.25)/2;
		AGE_INI_01=AGE01-DUR01;
		END;
END;

*** CURRENT SMOKERS ***;

ELSE IF STAT01='2' THEN DO;
	IF STAT99='2' THEN DO;			*** CONTINUOUS CURRENT SMOKERS ***;
		DUR01=DUR99 + (DTINT01A-DTINT99A)/365.25;
		AGE_INI_01=AGE_INI_99;
		END;
	ELSE IF STAT99='3' THEN DO;		*** CURRENT SMOKERS WHO WERE FORMER ***;
		DUR01= DUR99+(((DTINT01A-DTINT99A)/365.25)/2);
		AGE_INI_01=AGE_INI_99;
		END;
	ELSE IF STAT99='1' THEN DO;		*** CURRENT SMOKERS WHO WERE NEVER ***;
		DUR01= DUR99+(((DTINT01A-DTINT99A)/365.25)/2);
		AGE_INI_01=AGE01-DUR01;
		END;
END;


*** DURATION 2003 ***;
IF STAT03='1' THEN DUR03=DUR01;

*** FORMER SMOKERS ***;

ELSE IF STAT03='3' THEN DO;
	IF STAT01='3' THEN DO;
		DUR03=DUR01; *** CONTINUOUS FORMER SMOKERS ***;
		AGE_INI_03=AGE_INI_01;
		END;
	ELSE IF STAT01='2' THEN DO;     *** RECENTLY QUIT SMOKING ***;
		DUR03= DUR01 + ((DTINT03A-DTINT01A)/365.25)/2;
		AGE_INI_03=AGE_INI_01;
		END;
	ELSE IF STAT01='1' THEN DO;
		DUR03= ((DTINT03A-DTINT01A)/365.25)/2;
		AGE_INI_03=AGE03-DUR03;
		END;
END;

*** CURRENT SMOKERS ***;

ELSE IF STAT03='2' THEN DO;
	IF STAT01='2' THEN DO;			*** CONTINUOUS CURRENT SMOKERS ***;
		DUR03=DUR01 + (DTINT03A-DTINT01A)/365.25;
		AGE_INI_03=AGE_INI_01;
		END;
	ELSE IF STAT01='3' THEN DO;		*** CURRENT SMOKERS WHO WERE FORMER ***;
		DUR03= DUR01+(((DTINT03A-DTINT01A)/365.25)/2);
		AGE_INI_03=AGE_INI_01;
		END;
	ELSE IF STAT01='1' THEN DO;		*** CURRENT SMOKERS WHO WERE NEVER ***;
		DUR03= DUR01+(((DTINT03A-DTINT01A)/365.25)/2);
		AGE_INI_03=AGE03-DUR03;
		END;
END;

							
*** DURATION 2005 ***;
IF STAT05='1' THEN DUR05=DUR03;

*** FORMER SMOKERS ***;

ELSE IF STAT05='3' THEN DO;
	IF STAT03='3' THEN DO;
		DUR05=DUR03; *** CONTINUOUS FORMER SMOKERS ***;
		AGE_INI_05=AGE_INI_03;
		END;
	ELSE IF STAT03='2' THEN DO;     *** RECENTLY QUIT SMOKING ***;
		DUR05= DUR03 + ((DTINT05A-DTINT03A)/365.25)/2;
		AGE_INI_05=AGE_INI_03;
		END;
	ELSE IF STAT03='1' THEN DO;
		DUR05= ((DTINT05A-DTINT03A)/365.25)/2;
		AGE_INI_05=AGE05-DUR05;
		END;
END;

*** CURRENT SMOKERS ***;

ELSE IF STAT05='2' THEN DO;
	IF STAT03='2' THEN DO;			*** CONTINUOUS CURRENT SMOKERS ***;
		DUR05=DUR03 + (DTINT05A-DTINT03A)/365.25;
		AGE_INI_05=AGE_INI_03;
		END;
	ELSE IF STAT03='3' THEN DO;		*** CURRENT SMOKERS WHO WERE FORMER ***;
		DUR05= DUR03+(((DTINT05A-DTINT03A)/365.25)/2);
		AGE_INI_05=AGE_INI_03;
		END;
	ELSE IF STAT03='1' THEN DO;		*** CURRENT SMOKERS WHO WERE NEVER ***;
		DUR05= DUR03+(((DTINT05A-DTINT03A)/365.25)/2);
		AGE_INI_05=AGE05-DUR05;
		END;
END;



*** DURATION 2007 ***;
IF STAT07='1' THEN DUR07=DUR05;

*** FORMER SMOKERS ***;

ELSE IF STAT07='3' THEN DO;
	IF STAT05='3' THEN DO;
		DUR07=DUR05; *** CONTINUOUS FORMER SMOKERS ***;
		AGE_INI_07=AGE_INI_05;
		END;
	ELSE IF STAT05='2' THEN DO;     *** RECENTLY QUIT SMOKING ***;
		DUR07= DUR05 + ((DTINT07A-DTINT05A)/365.25)/2;
		AGE_INI_07=AGE_INI_05;
		END;
	ELSE IF STAT05='1' THEN DO;
		DUR07= ((DTINT07A-DTINT05A)/365.25)/2;
		AGE_INI_07=AGE07-DUR07;
		END;
END;

*** CURRENT SMOKERS ***;

ELSE IF STAT07='2' THEN DO;
	IF STAT05='2' THEN DO;			*** CONTINUOUS CURRENT SMOKERS ***;
		DUR07=DUR05 + (DTINT07A-DTINT05A)/365.25;
		AGE_INI_07=AGE_INI_05;
		END;
	ELSE IF STAT05='3' THEN DO;		*** CURRENT SMOKERS WHO WERE FORMER ***;
		DUR07= DUR05+(((DTINT07A-DTINT05A)/365.25)/2);
		AGE_INI_07=AGE_INI_05;
		END;
	ELSE IF STAT05='1' THEN DO;		*** CURRENT SMOKERS WHO WERE NEVER ***;
		DUR07= DUR05+(((DTINT07A-DTINT05A)/365.25)/2);
		AGE_INI_07=AGE07-DUR07;
		END;
END;


*** RECODE CPD FOR THREE PERIODS ***;

*****************;
* CPD 1999-2005	*;
* 1= 1-4 CPD	*;
* 2= 5-14 CPD	*;
* 3= 15-24 CPD	*;
* 4= 25-34 CPD	*;
* 5= 35-44 CPD	*;
* 6= 45+ CPD	*;
*****************;
 
ARRAY CPD_CAT(*) CPD_UPDATE_CAT_99 CPD_UPDATE_CAT_01 CPD_UPDATE_CAT_03 CPD_UPDATE_CAT_05 CPD_UPDATE_CAT_07;
ARRAY CPD_NEW(*) CPD99 CPD01 CPD03 CPD05 CPD07;
ARRAY STAT(*) $ STAT99 STAT01 STAT03 STAT05 STAT07;

DO I=1 TO DIM(CPD_CAT);

IF STAT(i) in ('2','3') THEN DO;
	IF CPD_CAT(i) IN(1,2) THEN CPD_NEW(i) = 1;	* <10 CPD *;
	ELSE IF CPD_CAT(i) = 3 THEN CPD_NEW(i) = 2; * 10-19 CPD *;
	ELSE IF CPD_CAT(i) IN(4,5) THEN CPD_NEW(i) = 3; * 20-39 CPD *;
	ELSE IF CPD_CAT(i) = 6 THEN CPD_NEW(i) = 4;	* 40+ CPD *;
	END;
END;

*****************;
* CPD 1997 		*;
* 1= 1-9 CPD	*;
* 2= 10 CPD		*;
* 3= 11-19 CPD	*;
* 4= 20 CPD		*;
* 5= 21+ CPD	*;
*****************;

IF STAT97 in ('2','3') THEN DO;
IF CPD_UPDATE_CAT_97 = 1 THEN CPD97=1; * <10 CPD *;
ELSE IF CPD_UPDATE_CAT_97 IN(2,3) THEN CPD97=2; * 10-19 CPD *;
ELSE IF CPD_UPDATE_CAT_97 IN(4,5) THEN CPD97=3; * 20-39 CPD *;
END;

*** IF '99 IS MISSING, USE ANOTHER FU PERIOD ***;

IF STAT99='3' AND STAT97='3' THEN DO;	* FOR CONTINUOUS FORMER SMOKERS, CPD ONLY ASKED IN 1992 *;
	CPD99=CPD92;
	END;


*PER BRIAN: FORMER SMOKERS SHOULD ONLY HAVE DURATION, NOT CPD*;
*SETTING CPD99 TO MISSING FOR FORMER SMOKERS - ADDED BY JB - 7/15/14*;
IF STAT99 IN ('2') THEN CPD99N=CPD99; *KEEPING CPD AS BRIAN CODED FOR CURRENT SMOKERS*;
ELSE CPD99N=9; *EVERYONE ELSE SET TO MISSING*;

FORMAT CPD99N CPDF.;

*ROUNDING SMOKING DURATION VARIABLE*;
DUR99N=ROUND(DUR99);
LABEL DUR99N="SMOKING DURATION FOR CURRENT/FORMER SMOKERS IN 1999 (YEARS)";

******************************************
* ASPIRIN USE (AT TIME OF BLOOD DRAW) *
******************************************;
***ASPIRIN CODE FOR REGULAR USE FROM ROMA'S VDPP DATASET***;
**DURATION VARIABLES (USING THESE TO CREATE VDPP VARIABLES)**;
*JENNY - FOR THIS USE ALLASP99 FOR REGULAR USE AND ALLASP3099 FOR DURATION, DOSE AND RECENCY*;

****1982****;
*ASPIRIN AND TYLENOL VARS*;
	ASP82 = 9;
		 IF ASPIRINX IN (.,0,96) AND ASPIRINB IN (.,0,96) THEN ASP82 = 0;
	ELSE IF ASPIRINX IN (97,98) 					  	  THEN ASP82 = 1;
	ELSE IF  1 <= ASPIRINX < 15						 	  THEN ASP82 = 2;
	ELSE IF 15 <= ASPIRINX < 30						 	  THEN ASP82 = 3;
	ELSE IF 30 <= ASPIRINX < 90 OR 91 <= ASPIRINX <= 95   THEN ASP82 = 4;
	 													  ELSE ASP82 = .M;
****1992****;
**CREATE 1992 NSAID VARIABLE CATEGORIES**
*  ASP92 IBU92 OND92 ACE92 ALL92  		*
*   0 = NO REGULAR USE 					*
*   1 = 1 - 14 PILLS/MONTH 				*
*   2 = 15 - 29 PILLS/MONTH				*
*   3 = 30 - 59 PILLS/MONTH				*
*   4 = 60 - 119 PILLS/MONTH 			*
*   5 = 120+ PILLS/MONTH 				*
*****************************************;
	ASPPPM92 = .; IBUPPM92 = .; OTHPPM92 = .; *ACEPPM92 = .; ALL_NOASP92 = .;
		 IF ASPDAY92 IN (.,0) AND ASPPIL92 IN (.,0) THEN ASPPPM92 = 0;
	ELSE IF ASPDAY92>0 AND ASPPIL92 IN (.,0) 		THEN ASPPPM92 = ASPDAY92;
	ELSE ASPPPM92 = ASPDAY92 * ASPPIL92;
		 IF IBUDAY92 IN (.,0) AND IBUPIL92 IN (.,0) THEN IBUPPM92 = 0;
	ELSE IF IBUDAY92 > 0 AND IBUPIL92 IN (.,0) 		THEN IBUPPM92 = IBUDAY92;
	ELSE IBUPPM92 = IBUDAY92 * IBUPIL92;
		 IF OTHDAY92 IN (.,0) AND OTHPIL92 IN (.,0) THEN OTHPPM92 = 0;
	ELSE IF OTHDAY92 > 0 AND OTHPIL92 IN (.,0) 		THEN OTHPPM92 = OTHDAY92;
	ELSE OTHPPM92 = OTHDAY92 * OTHPIL92;
	/*	 IF ACEDAY92 IN (.,0) AND ACEPIL92 IN (.,0) THEN ACEPPM92 = 0;*/
	/*ELSE IF ACEDAY92 > 0 AND ACEPIL92 IN (.,0) 		THEN ACEPPM92 = ACEDAY92;*/
	/*ELSE ACEPPM92 = ACEDAY92 * ACEPIL92;*/
	ALL_NOASP92 = SUM(IBUPPM92,OTHPPM92); *ALL NSAIDS, NO ASPIRIN;

	*ASPIRIN*;
	ASP92 = .;
	IF ASPDAY92 IN (.,0) AND ASPPIL92 IN (.,0) THEN ASP92 = 0;
	ELSE IF   0 <  ASPPPM92 <  15 			   THEN ASP92 = 1;
	ELSE IF  15 <= ASPPPM92 <  30 			   THEN ASP92 = 2;
	ELSE IF  30 <= ASPPPM92 <  60 			   THEN ASP92 = 3;
	ELSE IF  60 <= ASPPPM92 < 120 			   THEN ASP92 = 4;
	ELSE IF 120 <= ASPPPM92					   THEN ASP92 = 5;
	*IBUPROFEN*;
	IBU92 = .; 
	IF IBUDAY92 IN (.,0) AND IBUPIL92 IN (.,0) THEN IBU92 = 0;
	ELSE IF   0  < IBUPPM92 <  15 			   THEN IBU92 = 1;
	ELSE IF  15 <= IBUPPM92 <  30			   THEN IBU92 = 2;
	ELSE IF  30 <= IBUPPM92 <  60			   THEN IBU92 = 3;
	ELSE IF  60 <= IBUPPM92 < 120			   THEN IBU92 = 4;
	ELSE IF 120 <= IBUPPM92					   THEN IBU92 = 5;
	*OTHER ANTI-INFLAMMATORIES*;
	OND92 = .; 
	IF OTHDAY92 IN (.,0) AND OTHPIL92 IN (.,0) THEN OND92 = 0;
	ELSE IF   0  < OTHPPM92 <  15			   THEN OND92 = 1;
	ELSE IF  15 <= OTHPPM92 <  30			   THEN OND92 = 2;
	ELSE IF  30 <= OTHPPM92 <  60			   THEN OND92 = 3;
	ELSE IF  60 <= OTHPPM92 < 120			   THEN OND92 = 4;
	ELSE IF 120 <= OTHPPM92					   THEN OND92 = 5;
	/**ACETAMINOPHEN*;*/
	/*ACE92 = .;*/
	/*IF ACEDAY92 > 31 OR ACEPIL92 > 10				THEN ACE92 = .M;*/
	/*ELSE IF ACEDAY92 IN (.,0) AND ACEPIL92 > 0 		THEN ACE92 = .M;*/
	/*ELSE IF ACEDAY92 IN (.,0) AND ACEPIL92 IN (.,0) THEN ACE92 = 0;*/
	/*ELSE IF   0 <  ACEPPM92 <  15 					THEN ACE92 = 1;*/
	/*ELSE IF  15 <= ACEPPM92 <  30 					THEN ACE92 = 2;*/
	/*ELSE IF  30 <= ACEPPM92 <  60 					THEN ACE92 = 3;*/
	/*ELSE IF  60 <= ACEPPM92 < 120 					THEN ACE92 = 4;*/
	/*ELSE IF 120 <= ACEPPM92 						THEN ACE92 = 5;*/
	*ALL NSAIDS (NO ASPIRIN)*;
	ALL92 = .; 
	IF ALL_NOASP92 = 0				 THEN ALL92 = 0;
	ELSE IF   0 <  ALL_NOASP92 <  15 THEN ALL92 = 1;
	ELSE IF  15 <= ALL_NOASP92 <  30 THEN ALL92 = 2;
	ELSE IF  30 <= ALL_NOASP92 <  60 THEN ALL92 = 3;
	ELSE IF  60 <= ALL_NOASP92 < 120 THEN ALL92 = 4;
	ELSE IF 120 <= ALL_NOASP92		 THEN ALL92 = 5;

	*CREATE VARIABLE FOR ASPIRIN USE IN 1992 AND 1982*;
		 IF ASP82 = 0 AND ASP92 = 0 			  THEN ASP8292 = 0;
	ELSE IF ASP82 = 4 AND ASP92 IN (3,4,5) 		  THEN ASP8292 = 3;
	ELSE IF ASP82 IN (3,4) AND ASP92 IN (2,3,4,5) THEN ASP8292 = 2;
												  ELSE ASP8292 = 1;
****1997****;
**CREATE 1997 NSAID VARIABLE CATEGORIES**
*  ASP97 BASP97 IBU97 OND97 ACE97 ALL97	*
*   0 = NO REGULAR USE 					*
*   1 = 1 - 14 PILLS/MONTH 				*
*   2 = 15 - 29 PILLS/MONTH				*
*   3 = 30 - 59 PILLS/MONTH				*
*   4 = 60 - 119 PILLS/MONTH 			*
*   5 = 120+ PILLS/MONTH				*
*****************************************;
	ASPPPM97 = .; BASPPPM97 = .; IBUPPM97 = .; OTHPPM97 = .; *ACEPPM97 = .; ASPTPPM97 = .; ALL_NOASP97 = .;
		 IF REGDAY97 IN (.,0) AND REGPIL97 IN (.,0) THEN ASPPPM97 = 0;
	ELSE IF REGDAY97 > 0 AND REGPIL97 IN (.,0)		THEN ASPPPM97 = REGDAY97;
	ELSE ASPPPM97 = REGDAY97 * REGPIL97;
		 IF BADAY97 IN (.,0) AND BAPIL97 IN (.,0) THEN BASPPPM97 = 0;
	ELSE IF BADAY97 > 0 AND BAPIL97 IN (.,0) 	  THEN BASPPPM97 = BADAY97;
	ELSE BASPPPM97 = BADAY97 * BAPIL97;
	/* 	 IF ACEDAY97 IN (.,0) AND ACEPIL97 IN (.,0) THEN ACEPPM97 = 0;*/
	/*ELSE IF ACEDAY97 > 0 AND ACEPIL97 IN (.,0) 		THEN ACEPPM97 = ACEDAY97;*/
	/*ELSE ACEPPM97 = ACEDAY97 * ACEPIL97;*/
		 IF IBUDAY97 IN (.,0) AND IBUPIL97 IN (.,0) THEN IBUPPM97 = 0;
	ELSE IF IBUDAY97 > 0 AND IBUPIL97 IN (.,0)	 	THEN IBUPPM97 = IBUDAY97;
	ELSE IBUPPM97 = IBUDAY97 * IBUPIL97;
		 IF OTHDAY97 IN (.,0) AND OTHPIL97 IN (.,0) THEN OTHPPM97 = 0;
	ELSE IF OTHDAY97 > 0 AND OTHPIL97 IN (.,0) 		THEN OTHPPM97 = OTHDAY97;
	ELSE OTHPPM97 = OTHDAY97 * OTHPIL97;

	ASPTPPM97 = SUM(ASPPPM97,BASPPPM97);
	ALL_NOASP97 = SUM(IBUPPM97,OTHPPM97);

	*ASPIRIN*;
	ASP97 = .;
	IF NUT_97 = 0 THEN ASP97 = .N;
	ELSE IF REGDAY97 IN (.,0) AND REGPIL97 > 0 THEN ASP97 = .U;
	ELSE IF REGDAY97 > 31 OR REGPIL97 > 10 THEN ASP97 = .U;
	ELSE IF ASPUSE97 = '8' OR BASPUSE97 = '8' OR IBUUSE97 = '8' OR ONDUSE97 = '8' THEN ASP97 = .U;
	ELSE IF REGDAY97 IN (.,0) AND REGPIL97 IN (.,0) THEN ASP97 = 0;
	ELSE IF   0 <  ASPPPM97 <  15					THEN ASP97 = 1;
	ELSE IF  15 <= ASPPPM97 <  30					THEN ASP97 = 2;
	ELSE IF  30 <= ASPPPM97 <  60					THEN ASP97 = 3;
	ELSE IF  60 <= ASPPPM97 < 120					THEN ASP97 = 4;
	ELSE IF 120 <= ASPPPM97							THEN ASP97 = 5;
	*BABY ASPIRIN*;
	BASP97 = .; 
	IF NUT_97 = 0 THEN BASP97 = .N;
	ELSE IF BADAY97 IN (.,0) AND BAPIL97 > 0 THEN BASP97 = .U;
	ELSE IF BADAY97 > 31 OR BAPIL97 > 10 THEN BASP97 = .U;
	ELSE IF ASPUSE97 = '8' OR BASPUSE97='8' OR IBUUSE97='8' OR ONDUSE97='8' THEN BASP97=.U;
	ELSE IF BADAY97 IN (.,0) AND BAPIL97 IN (.,0) THEN BASP97=0;
	ELSE IF 0<BASPPPM97<15 THEN BASP97=1;
	ELSE IF 15<=BASPPPM97<30 THEN BASP97=2;
	ELSE IF 30<=BASPPPM97<60 THEN BASP97=3;
	ELSE IF 60<=BASPPPM97<120 THEN BASP97=4;
	ELSE IF 120<=BASPPPM97 THEN BASP97=5;
	*ALL ASPIRIN, BABY ASPIRIN=1*;
	ALLASP97 = .;
	IF NUT_97 = 0 THEN ALLASP97 = .N;
	ELSE IF BASP97 = .U OR ASP97 = .U THEN ALLASP97 = .U;
	ELSE IF BASP97 = 0 AND ASP97 = 0  THEN ALLASP97 = 0;
	ELSE IF   0 <  ASPTPPM97 <  15 	  THEN ALLASP97 = 1;
	ELSE IF  15 <= ASPTPPM97 <  30 	  THEN ALLASP97 = 2;
	ELSE IF  30 <= ASPTPPM97 <  60 	  THEN ALLASP97 = 3;
	ELSE IF  60 <= ASPTPPM97 < 120 	  THEN ALLASP97 = 4;
	ELSE IF 120 <= ASPTPPM97 		  THEN ALLASP97 = 5;
	/**ALL ASPIRIN, BABY ASPIRIN=1/4*;*/
	/*RBASP97 = .;*/
	/*IF NUT_97 = 0 				 THEN RBASP97 = .N;*/
	/*ELSE IF RBPPM97 = .			 THEN RBASP97 = .U;*/
	/*ELSE IF RBPPM97 = 0			 THEN RBASP97 = 0;*/
	/*ELSE IF   0 <  RBPPM97 <  15 THEN RBASP97 = 1;*/
	/*ELSE IF  15 <= RBPPM97 <  30 THEN RBASP97 = 2;*/
	/*ELSE IF  30 <= RBPPM97 <  60 THEN RBASP97 = 3;*/
	/*ELSE IF  60 <= RBPPM97 < 120 THEN RBASP97 = 4;*/
	/*ELSE IF 120 <= RBPPM97 		 THEN RBASP97 = 5;*/
	*IBUPROFEN*;
	IBU97 = .;
	IF NUT_97 = 0 THEN IBU97 = .N;
	ELSE IF IBUDAY97 IN (.,0) AND IBUPIL97 > 0 THEN IBU97 = .U;
	ELSE IF IBUDAY97 > 31 OR IBUPIL97 > 10 THEN IBU97 = .U;
	ELSE IF ASPUSE97 = '8' OR BASPUSE97 = '8' OR IBUUSE97 = '8' OR ONDUSE97 = '8' THEN IBU97 = .U;
	ELSE IF IBUDAY97 IN (.,0) AND IBUPIL97 IN (.,0) THEN IBU97 = 0;
	ELSE IF   0 <  IBUPPM97 <  15 					THEN IBU97 = 1;
	ELSE IF  15 <= IBUPPM97 <  30 					THEN IBU97 = 2;
	ELSE IF  30 <= IBUPPM97 <  60 					THEN IBU97 = 3;
	ELSE IF  60 <= IBUPPM97 < 120 					THEN IBU97 = 4;
	ELSE IF 120 <= IBUPPM97 						THEN IBU97 = 5;
	*OTHER ANTI-INFLAMMATORIES*;
	OND97 = .;
	IF NUT_97 = 0 THEN OND97 = .N;
	ELSE IF OTHDAY97 IN (.,0) AND OTHPIL97 > 0 THEN OND97 = .U;
	ELSE IF OTHDAY97 > 31 OR OTHPIL97 > 10 THEN OND97 = .U;
	ELSE IF ASPUSE97 = '8' OR BASPUSE97 = '8' OR IBUUSE97 = '8' OR ONDUSE97 = '8' THEN OND97 = .U;
	ELSE IF OTHDAY97 IN (.,0) AND OTHPIL97 IN (.,0) THEN OND97 = 0;
	ELSE IF   0 <  OTHPPM97 <  15 					THEN OND97 = 1;
	ELSE IF  15 <= OTHPPM97 <  30 					THEN OND97 = 2;
	ELSE IF  30 <= OTHPPM97 <  60 					THEN OND97 = 3;
	ELSE IF  60 <= OTHPPM97 < 120 					THEN OND97 = 4;
	ELSE IF 120 <= OTHPPM97 						THEN OND97 = 5;
	/**ACETAMINOPHEN*;*/
	/*ACE97 = .;*/
	/*IF NUT_97 = 0 THEN ACE97 = .N;*/
	/*ELSE IF ACEDAY97 IN (.,0) AND ACEPIL97 > 0 THEN ACE97 = .U;*/
	/*ELSE IF ACEDAY97 > 31 OR ACEPIL97 > 10 THEN ACE97 = .U;*/
	/*ELSE IF ASPUSE97 = '8' OR BASPUSE97 = '8' OR IBUUSE97 = '8' OR ONDUSE97 = '8' THEN ACE97 = .U;*/
	/*ELSE IF ACEDAY97 IN (.,0) AND ACEPIL97 IN (.,0) THEN ACE97 = 0;*/
	/*ELSE IF   0 <  ACEPPM97 <  15 					THEN ACE97 = 1;*/
	/*ELSE IF  15 <= ACEPPM97 <  30 					THEN ACE97 = 2;*/
	/*ELSE IF  30 <= ACEPPM97 <  60 					THEN ACE97 = 3;*/
	/*ELSE IF  60 <= ACEPPM97 < 120 					THEN ACE97 = 4;*/
	/*ELSE IF 120 <= ACEPPM97 						THEN ACE97 = 5;*/
	*ALL NSAIDS, NO ASPIRIN*;
	ALL97 = .;
	IF NUT_97 = 0 THEN ALL97 = .N;
	ELSE IF ALL_NOASP97 = . 		 THEN ALL97 = .U;
	ELSE IF ALL_NOASP97 = 0 		 THEN ALL97 = 0;
	ELSE IF   0 <  ALL_NOASP97 <  15 THEN ALL97 = 1;
	ELSE IF  15 <= ALL_NOASP97 <  30 THEN ALL97 = 2;
	ELSE IF  30 <= ALL_NOASP97 <  60 THEN ALL97 = 3;
	ELSE IF  60 <= ALL_NOASP97 < 120 THEN ALL97 = 4;
	ELSE IF 120 <= ALL_NOASP97 		 THEN ALL97 = 5;
****1999****;
		**CREATING FLAG FOR 1999 MEDICATION SECTION MISSING (FLAG IF ALL ARE MISSING)**;
		FLAGN99 = ''; FLAGD99 = ''; FLAGP99 = ''; 
		IF BANEV99=REGNEV99=IBUNEV99=ACENEV99=OTHNEV99='' THEN FLAGN99='1';
		IF BADAY99=REGDAY99=IBUDAY99=ACEDAY99=OTHDAY99=.  THEN FLAGD99='1';
		IF BAPIL99=REGPIL99=IBUPIL99=ACEPIL99=OTHPIL99=.  THEN FLAGP99='1';
**CREATE 1999 NSAID VARIABLE CATEGORIES**
*  ASP99 BASP99 IBU99 OND99 ACE99 ALL99 *
*   0 = NO REGULAR USE 					*
*   1 = 1 - 14 PILLS/MONTH 				*
*   2 = 15 - 29 PILLS/MONTH				*
*   3 = 30 - 59 PILLS/MONTH				*
*   4 = 60 - 119 PILLS/MONTH 			*
*   5 = 120+ PILLS/MONTH				*
*****************************************;
	ASPPPM99 = .; BASPPPM99 = .; IBUPPM99 = .; OTHPPM99 = .; *ACEPPM99 = .; ASPTPPM99 = .; ALL_NOASP99 = .;
		 IF REGDAY99 IN (.,0) AND REGPIL99 IN (.,0) THEN ASPPPM99 = 0;
	ELSE IF REGDAY99 > 0 AND REGPIL99 IN (.,0) 		THEN ASPPPM99 = REGDAY99;
	ELSE ASPPPM99 = REGDAY99 * REGPIL99;
		IF BADAY99 IN (.,0) AND BAPIL99 IN (.,0) THEN BASPPPM99 = 0;
	ELSE IF BADAY99 > 0 AND BAPIL99 IN (.,0) 	 THEN BASPPPM99 = BADAY99;
	ELSE BASPPPM99 = BADAY99 * BAPIL99;
		IF IBUDAY99 IN (.,0) AND IBUPIL99 IN (.,0) THEN IBUPPM99 = 0;
	ELSE IF IBUDAY99 > 0 AND IBUPIL99 IN (.,0) 	   THEN IBUPPM99 = IBUDAY99;
	ELSE IBUPPM99 = IBUDAY99 * IBUPIL99;
		IF OTHDAY99 IN (.,0) AND OTHPIL99 IN (.,0) THEN OTHPPM99 = 0;
	ELSE IF OTHDAY99 > 0 AND OTHPIL99 IN (.,0) 	   THEN OTHPPM99 = OTHDAY99;
	ELSE OTHPPM99 = OTHDAY99 * OTHPIL99;
	/*	IF ACEDAY99 IN (.,0) AND ACEPIL99 IN (.,0) THEN ACEPPM99 = 0;*/
	/*ELSE IF ACEDAY99 > 0 AND ACEPIL99 IN (.,0) 	   THEN ACEPPM99 = ACEDAY99;*/
	/*ELSE ACEPPM99 = ACEDAY99 * ACEPIL99;*/

	ASPTPPM99 = SUM(ASPPPM99,BASPPPM99);
	ALL_NOASP99 = SUM(IBUPPM99,OTHPPM99);

	*ASPIRIN*;
	ASP99 = .;
	IF NUT_99 = 0 THEN ASP99 = .N;	
	ELSE IF REGDAY99 IN (.,0) AND REGPIL99 > 0 THEN ASP99 = .U;
	ELSE IF REGDAY99 > 31 OR REGPIL99 > 10 THEN ASP99 = .U;
	ELSE IF REGDAY99 = .I OR REGPIL99 = .I THEN ASP99 = .U;
	ELSE IF FLAGN99 = FLAGD99 = FLAGP99 = '1' THEN ASP99 = .U;
	ELSE IF REGDAY99 IN (.,0) AND REGPIL99 IN (.,0) THEN ASP99 = 0;
	ELSE IF   0 <  ASPPPM99 <  15 THEN ASP99 = 1;
	ELSE IF  15 <= ASPPPM99 <  30 THEN ASP99 = 2;
	ELSE IF  30 <= ASPPPM99 <  60 THEN ASP99 = 3;
	ELSE IF  60 <= ASPPPM99 < 120 THEN ASP99 = 4;
	ELSE IF 120 <= ASPPPM99 	  THEN ASP99 = 5;
	*BABY ASPIRIN*;
	BASP99 = .;
	IF NUT_99 = 0 THEN BASP99 = .N;
	ELSE IF BADAY99 IN (.,0) AND BAPIL99 > 0 THEN BASP99 = .U;
	ELSE IF BADAY99 > 31 OR BAPIL99 > 10 THEN BASP99 = .U;
	ELSE IF BADAY99 = .I OR BAPIL99 = .I THEN BASP99 = .U;
	ELSE IF FLAGN99 = FLAGD99 = FLAGP99 = '1' THEN BASP99 = .U;
	ELSE IF BADAY99 IN (.,0) AND BAPIL99 IN (.,0) THEN BASP99 = 0;
	ELSE IF   0 <  BASPPPM99 <  15 THEN BASP99 = 1;
	ELSE IF  15 <= BASPPPM99 <  30 THEN BASP99 = 2;
	ELSE IF  30 <= BASPPPM99 <  60 THEN BASP99 = 3;
	ELSE IF  60 <= BASPPPM99 < 120 THEN BASP99 = 4;
	ELSE IF 120 <= BASPPPM99	   THEN BASP99 = 5;
	*ALL ASPIRIN, BABY ASPIRIN=1*;
	ALLASP99 = .;
	IF NUT_99 = 0 THEN ALLASP99 = .N;
	ELSE IF BASP99 = .U OR ASP99 = .U THEN ALLASP99 = .U;
	ELSE IF BASP99 = 0 AND ASP99 = 0 THEN ALLASP99 = 0;
	ELSE IF   0 <  ASPTPPM99 <  15 THEN ALLASP99 = 1;
	ELSE IF  15 <= ASPTPPM99 <  30 THEN ALLASP99 = 2;
	ELSE IF  30 <= ASPTPPM99 <  60 THEN ALLASP99 = 3;
	ELSE IF  60 <= ASPTPPM99 < 120 THEN ALLASP99 = 4;
	ELSE IF 120 <= ASPTPPM99 	   THEN ALLASP99 = 5;
	*ADDED BY JB 7/16/14 - CONVERTING MISSINGS TO 9 FOR MODELING*;
	IF ALLASP99 IN (.N,.U) THEN ALLASP99=9;
	FORMAT ALLASP99 ASPREGF.;
	*IBUPROFEN*;
	IBU99 = .;
	IF NUT_99 = 0 THEN IBU99 = .N;
	ELSE IF IBUDAY99 IN (.,0) AND IBUPIL99>0 THEN IBU99 = .U;
	ELSE IF IBUDAY99 > 31 OR IBUPIL99 > 10 THEN IBU99 = .U;
	ELSE IF IBUDAY99 = .I OR IBUPIL99 = .I THEN IBU99 = .U;
	ELSE IF FLAGN99 = FLAGD99 = FLAGP99 = '1' THEN IBU99 = .U;
	ELSE IF IBUDAY99 IN (.,0) AND IBUPIL99 IN (.,0) THEN IBU99 = 0;
	ELSE IF   0 <  IBUPPM99 <  15 THEN IBU99 = 1;
	ELSE IF  15 <= IBUPPM99 <  30 THEN IBU99 = 2;
	ELSE IF  30 <= IBUPPM99 <  60 THEN IBU99 = 3;
	ELSE IF  60 <= IBUPPM99 < 120 THEN IBU99 = 4;
	ELSE IF 120 <= IBUPPM99 	  THEN IBU99 = 5;
	*OTHER ANTI-INFLAMMATORIES*;
	OND99 = .;
	IF NUT_99 = 0 THEN OND99 = .N;
	ELSE IF OTHDAY99 IN (.,0) AND OTHPIL99 > 0 THEN OND99 = .U;
	ELSE IF OTHDAY99 > 31 OR OTHPIL99 > 10 THEN OND99 = .U;
	ELSE IF OTHDAY99 = .I OR OTHPIL99 = .I THEN OND99 = .U;
	ELSE IF FLAGN99 = FLAGD99 = FLAGP99 = '1' THEN OND99 = .U;
	ELSE IF OTHDAY99 IN (.,0) AND OTHPIL99 IN (.,0) THEN OND99 = 0;
	ELSE IF   0 <  OTHPPM99 <  15 THEN OND99 = 1;
	ELSE IF  15 <= OTHPPM99 <  30 THEN OND99 = 2;
	ELSE IF  30 <= OTHPPM99 <  60 THEN OND99 = 3;
	ELSE IF  60 <= OTHPPM99 < 120 THEN OND99 = 4;
	ELSE IF 120 <= OTHPPM99 	  THEN OND99 = 5;
	*ACETAMINOPHEN*;
	/*ACE99 = .;*/
	/*IF NUT_99 = 0 THEN ACE99 = .N;*/
	/*ELSE IF ACEDAY99 IN (.,0) AND ACEPIL99 > 0 THEN ACE99 = .U;*/
	/*ELSE IF ACEDAY99 > 31 OR ACEPIL99 > 10 THEN ACE99 = .U;*/
	/*ELSE IF ACEDAY99 = .I OR ACEPIL99 = .I THEN ACE99 = .U;*/
	/*ELSE IF FLAGN99 = FLAGD99 = FLAGP99 = '1' THEN ACE99 = .U;*/
	/*ELSE IF ACEDAY99 IN (.,0) AND ACEPIL99 IN (.,0) THEN ACE99 = 0;*/
	/*ELSE IF   0 <  ACEPPM99 <  15 THEN ACE99 = 1;*/
	/*ELSE IF  15 <= ACEPPM99 <  30 THEN ACE99 = 2;*/
	/*ELSE IF  30 <= ACEPPM99 <  60 THEN ACE99 = 3;*/
	/*ELSE IF  60 <= ACEPPM99 < 120 THEN ACE99 = 4;*/
	/*ELSE IF 120 <= ACEPPM99		  THEN ACE99 = 5;*/
	*ALL NSAIDS, NO ASPIRIN*;
	ALL99 = .;
	IF NUT_99 = 0 THEN ALL99 = .N;
	ELSE IF ALL_NOASP99 = . THEN ALL99 = .U;
	ELSE IF ALL_NOASP99 = 0 THEN ALL99 = 0;
	ELSE IF   0 <  ALL_NOASP99 <  15 THEN ALL99 = 1;
	ELSE IF  15 <= ALL_NOASP99 <  30 THEN ALL99 = 2;
	ELSE IF  30 <= ALL_NOASP99 <  60 THEN ALL99 = 3;
	ELSE IF  60 <= ALL_NOASP99 < 120 THEN ALL99 = 4;
	ELSE IF 120 <= ALL_NOASP99 		 THEN ALL99 = 5;


**CREATING DURATION VAR BASED ON REGULARITY OF REPORTING (04/07/2006)**;
  **CATEGORIES: 0=NEVER, 1=OCCASIONAL/FORMER, 2=30+DAYS/MO,<5 YRS, 3=30+DAYS/MO,5+YRS**;
	*NOTE: I THINK THIS CODE LUMPS UNKNOWN INTO CATEGORY 1 - CHRISSY HAS CODE THAT SEPERATES THIS INTO UNKNOWN IF NEED TO CHANGE*;

*ASPIRIN 30+ DAYS (NO LONGER PILLS) PER MONTH (COUNTING BABY ASPIRIN AS WHOLE PILL, OR 1)*;
	*1992*;
		 IF ASP82 = 0 AND ASP92 = 0 							THEN ALLASP3092 = 0;
	ELSE IF ASP82 = 4 AND ASPDAY92 IN (30,31) AND ASPYRS92 >= 5 THEN ALLASP3092 = 3;
	ELSE IF ASPDAY92 IN (30,31) 								THEN ALLASP3092 = 2;
																ELSE ALLASP3092 = 1;
	*1997*;
		 IF ASP82 = 0 AND ASP92 = 0 AND ASP97 = 0 AND BASP97 = 0				THEN ALLASP3097 = 0;
	ELSE IF ASPDAY92 IN (30,31) AND (REGDAY97 IN (30,31) OR BADAY97 IN (30,31)) THEN ALLASP3097 = 3;
	ELSE IF REGDAY97 IN (30,31) OR BADAY97 IN (30,31) 							THEN ALLASP3097 = 2;
																				ELSE ALLASP3097 = 1;
	*1999: WILL USE THIS VARIABLE FOR FREQUENCY AND DURATION VARIABLES (FOR ASPIRIN USE)*;
		 IF ASP82 = 0 AND ASP92 = 0 AND ASP97 = 0 AND BASP97 = 0 AND ASP99 = 0 AND BASP99 = 0 THEN ALLASP3099 = 0;
	ELSE IF ASPDAY92 IN (30,31) AND (REGDAY97 IN (30,31) OR BADAY97 IN (30,31))
											  AND (REGDAY99 IN (30,31) OR BADAY99 IN (30,31)) THEN ALLASP3099 = 3;
	ELSE IF REGDAY99 IN (30,31) OR BADAY99 IN (30,31)										  THEN ALLASP3099 = 2;
																							  ELSE ALLASP3099 = 1;
	FORMAT ALLASP3099 ASPDURF.;


*H. PYLORI ANTIBIOTIC USE - 2001 SURVEY*;
*IF ANTIBIOTIC USE AFTER LL THEN SETTING TO 0, ELSE SETTING TO 1*;

IF HPYL01='1' AND HPYLAG01 NE . THEN HPYANTI=9;
ELSE IF HPYL01=' ' AND HPYLAG01 NE . THEN HPYANTI=9;
ELSE IF HPYL01='1' THEN HPYANTI=0; *NO HPY ANTIBIOTIC USE*;
ELSE IF HPYL01='2' AND HPYLAG01 = . THEN HPYANTI=9; *OBS WITHOUT AGE -DONT KNOW WHEN ANTIBIOTIC TAKEN - SET TO MISSING*;
ELSE IF (HPYL01='2') AND (HPYLAG01 GT AGELL) THEN HPYANTI=0; *TOOK ANTIBIOTIC AFTER BLOOD DRAWN*;
ELSE IF (HPYL01='2') AND (HPYLAG01 LE AGELL) THEN HPYANTI=1; *TOOK ANTIBIOTIC AT OR BEFORE TIME OF BLOOD DRAW*;
ELSE HPYANTI=9;

LABEL HPYANTI='H PYLORI ANTIBIOTIC USE (2001 SURVEY)';
FORMAT HPYANTI YESNOF.;

***IBD***;
*ALTERED CODE FROM CHRISSY - ONLY INCLUDING OBS DIAGNOSED PRIOR TO 10/99*;
ULCOL01=0;
IF NUT_01=0 THEN ULCOL01=9;
ELSE IF SURVEY01 IN ('PHONE','SHORT') THEN ULCOL01=9;
*ELSE IF ULCOLY01='1' THEN ULCOL01=1; *SETTING TO 0 IF ONLY MARKED YES BUT DIDNT MARK A DATE (N=1)*;
ELSE IF ULCOLD01=1 THEN ULCOL01=1; *DX DATE BEORE 10/99, 10/99 TO 9/01, AFTER 9/01*;

LABEL ULCOL01='INFLAMMATORY BOWEL DISEASE';
FORMAT ULCOL01 YESNOF.;

*DUMMY VARIABLES FOR SPLINE MODELS*;

*EDUCA*;
EDUCA1=0; EDUCA2=0; EDUCA3=0; EDUCA4=0;
IF EDUCA=1 THEN EDUCA1=1;
ELSE IF EDUCA=2 THEN EDUCA2=1;
ELSE IF EDUCA=3 THEN EDUCA3=1;
ELSE IF EDUCA=4 THEN EDUCA4=1;

*RACE*;
RACE1=0; RACE2=0; RACE3=0;
IF RACENEW=1 THEN RACE1=1;
ELSE IF RACENEW=2 THEN RACE2=1;
ELSE IF RACENEW=9 THEN RACE3=1;

*BMI*;
BMI1=0; BMI2=0; BMI3=0; BMI4=0;
IF BMIWHO=0 THEN BMI1=1;
ELSE IF BMIWHO=1 THEN BMI2=1;
ELSE IF BMIWHO=2 THEN BMI3=1;
ELSE IF BMIWHO=9 THEN BMI4=1;

*SMOKING STATUS*;
SMKSTAT1=0; SMKSTAT2=0; SMKSTAT3=0; SMKSTAT4=0;
IF STAT99='1' THEN SMKSTAT1=1;
ELSE IF STAT99='2' THEN SMKSTAT2=1;
ELSE IF STAT99='3' THEN SMKSTAT3=1;
ELSE IF STAT99='9' THEN SMKSTAT4=1;

*ALCOHOL*;
ALC1=0; ALC2=0; ALC3=0; ALC4=0;
IF ALC99=1 THEN ALC1=1;
ELSE IF ALC99=2 THEN ALC2=1;
ELSE IF ALC99=3 THEN ALC3=1;
ELSE IF ALC99=9 THEN ALC4=1;

*MARITAL STATUS*;
MAR_STAT1=0; MAR_STAT2=0; MAR_STAT3=0; MAR_STAT4=0; MAR_STAT5=0;
IF MAR_STAT=1 THEN MAR_STAT1=1;
ELSE IF MAR_STAT=2 THEN MAR_STAT2=1;
ELSE IF MAR_STAT=3 THEN MAR_STAT3=1;
ELSE IF MAR_STAT=4 THEN MAR_STAT4=1;
ELSE IF MAR_STAT=9 THEN MAR_STAT5=1;

*MEAT*;
MEAT1=0; MEAT2=0; MEAT3=0; 
IF MEAT99_CAT=0 THEN MEAT1=1;
ELSE IF MEAT99_CAT=1 THEN MEAT2=1;
ELSE IF MEAT99_CAT=2 THEN MEAT3=1;

*CRC SCREENING*;
SCREEN1=0; SCREEN2=0; SCREEN3=0; 
IF SCREEN99=0 THEN SCREEN1=1;
ELSE IF SCREEN99=1 THEN SCREEN2=1;
ELSE IF SCREEN99=9 THEN SCREEN3=1;

*PHYSICAL ACTIVITY*;
PA1=0; PA2=0; PA3=0; PA4=0;
IF PA99=0 THEN PA1=1;
ELSE IF PA99=1 THEN PA2=1;
ELSE IF PA99=2 THEN PA3=1;
ELSE IF PA99=9 THEN PA4=1;

*HORMONE REPLACEMENT THERAPY*;
HRT1=0; HRT2=0; HRT3=0; HRT4=0; HRT5=0; HRT6=0;
IF HRT6GRP99=0 THEN HRT1=1;
ELSE IF HRT6GRP99=1 THEN HRT2=1;
ELSE IF HRT6GRP99=2 THEN HRT3=1;
ELSE IF HRT6GRP99=3 THEN HRT4=1;
ELSE IF HRT6GRP99=4 THEN HRT5=1;
ELSE IF HRT6GRP99=9 THEN HRT6=1;

*ANTIBIOTIC USE*;
AB1=0; AB2=0; AB3=0;
IF ANTIB99=0 THEN AB1=1;
ELSE IF ANTIB99=1 THEN AB2=1;
ELSE IF ANTIB99=9 THEN AB3=1;

*RECENT SCREENING*;
RSCREEN1=0; RSCREEN2=0; RSCREEN3=0;
IF RSCREEN99=0 THEN RSCREEN1=1;  
ELSE IF RSCREEN99=1 THEN RSCREEN2=1;
ELSE IF RSCREEN99=9 THEN RSCREEN3=1;

*RECENT POLYPS*;
RPOL1=0; RPOL2=0; RPOL3=0; RPOL4=0; RPOL5=0; 
IF RCOLPOL99=0 THEN RPOL1=1;
ELSE IF RCOLPOL99=1 THEN RPOL2=1;
ELSE IF RCOLPOL99=2 THEN RPOL3=1;
ELSE IF RCOLPOL99=3 THEN RPOL4=1;
ELSE IF RCOLPOL99=9 THEN RPOL5=1;

*REGULAR ASPIRIN USE*;
REGASP1=0; REGASP2=0; REGASP3=0; REGASP4=0; REGASP5=0; REGASP6=0; REGASP7=0;	
IF ALLASP99=0 THEN REGASP1=1;
ELSE IF ALLASP99=1 THEN REGASP2=1;
ELSE IF ALLASP99=2 THEN REGASP3=1;
ELSE IF ALLASP99=3 THEN REGASP4=1;	
ELSE IF ALLASP99=4 THEN REGASP5=1;
ELSE IF ALLASP99=5 THEN REGASP6=1;
ELSE REGASP7=1; *ALL MISSINGS*;

*ASPIRIN DURATION/DOSE/RECENCY*;
DURASP1=0; DURASP2=0; DURASP3=0; DURASP4=0; 
IF ALLASP3099=0 THEN DURASP1=1;
ELSE IF ALLASP3099=1 THEN DURASP2=1;
ELSE IF ALLASP3099=2 THEN DURASP3=1;
ELSE IF ALLASP3099=3 THEN DURASP4=1;

*CIGARETTES PER DAY*;
CPD1=0; CPD2=0; CPD3=0; CPD4=0; CPD5=0;
IF CPD99N=1 THEN CPD1=1;
ELSE IF CPD99N=2 THEN CPD2=1;
ELSE IF CPD99N=3 THEN CPD3=1;
ELSE IF CPD99N=4 THEN CPD4=1;
ELSE IF CPD99N=. THEN CPD5=1;

*HPY ANTIBIOTIC USE*;
HPYANTI1=0; HPYANTI2=0; HPYANTI3=0;
IF HPYANTI=0 THEN HPYANTI1=1;
ELSE IF HPYANTI=1 THEN HPYANTI2=1;
ELSE IF HPYANTI=9 THEN HPYANTI3=1;



********DEFINING DEATHS AND DEATH DATE*********;
DEAD=0;
IF INMORT AND DATEDD<=MDY(6,30,2009) THEN DO;
	DEAD=1;
	DEATHDT=DATEDD;
END;

***DEFINING VERIFIED COLON/RECTUM CANCER;
      COLONV=0; RECTALV=0;
            IF INCCANV IN ('C18') THEN COLONV=1;
      ELSE IF INCCANV IN ('C19','C20') THEN RECTALV=1;
      LABEL COLONV='VERIFIED COLON CANCER'
              RECTALV='VERIFIED RECTAL CANCER';

***DEATH FROM CRC***;
      IF DEAD=1 THEN DO;

      *PRIMARY CODE FROM COLON OR RECTAL CANCER*;
                  IF CODETYPE='2' AND ('153'<=CODE1<='1539') THEN COLOND=1;        
            ELSE IF CODETYPE='3' AND ('C18'<=CODE1<='C189') THEN COLOND=1;    
            ELSE IF CODETYPE='2' AND ('154'<=CODE1<='1549') THEN RECTALD=1;  
            ELSE IF CODETYPE='3' AND ('C19'<=CODE1<='C209') THEN RECTALD=1;  
      END;
      LABEL COLOND='COLON CANCER DEATH'
              RECTALD='RECTAL CANCER DEATH';

***DEATH FROM COLON CANCER - ALL***;
      CRCADTH=0;
      IF COLOND=1 OR RECTALD=1 THEN CRCADTH=1;
      LABEL CRCADTH='Colorectal Cancer Death';

***CRC CASE, COLON CASE, RECTAL CASE (VERIFIED > DTH CERTIFICATE)***;
      CRCA=0;     COLONCA=0; RECTALCA=0; CRCSITE=0;

/*      ***COLORECTAL***;*/
/*                  IF CRCAV=1 THEN CRCA=1;*/
/*            ELSE IF CRCADTH=1 THEN CRCA=1;*/

      ***COLON***;
                  IF COLONV=1 THEN COLONCA=1;  
            ELSE IF COLOND=1 AND RECTALV^=1 THEN COLONCA=1;

      ***RECTUM***;
                  IF RECTALV=1 THEN RECTALCA=1;
            ELSE IF RECTALD=1 AND COLONV^=1 THEN RECTALCA=1;

            IF COLONCA=1  THEN CRCSITE=1;
      ELSE IF RECTALCA=1 THEN CRCSITE=2;

      LABEL CRCA='CRC CASE'
              COLONCA='COLON CASE'
              RECTALCA='RECTAL CASE';

*SUBJID='009833' IS BOTH A CASE AND CONTROL. WHEN ITS A CONTROL FOR SOME REASON ITS COMING UP AS HAVING RECTAL CANCER (RECTALCA=1). BIOSPECIMENS SAID I SHOULD CORRECT THIS*;
IF SUBJID='009833' AND CACONEW=0 THEN RECTALCA=0;

RUN;


